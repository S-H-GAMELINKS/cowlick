window.gLocalAssetContainer["main"] = function(g) { (function(exports, require, module, __filename, __dirname) {
module.exports=function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=34)}([function(t,e,i){"use strict";function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),n(i(3)),n(i(4)),n(i(5)),n(i(6)),n(i(2)),n(i(1))},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e,i){var n=this.constructor,r=t.call(this,e)||this;return Object.setPrototypeOf(r,n.prototype),r.data=i,r}return n(e,t),e}(Error);e.GameError=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.collectAssetIds=function(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];"object"==typeof r.data&&(r.data.assetId?e.push(r.data.assetId):r.data.backgroundImage&&e.push(r.data.backgroundImage))}return e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){t.choice="choice",t.image="image",t.pane="pane",t.jump="jump",t.text="text",t.layerConfig="layerConfig",t.playAudio="playAudio",t.changeVolume="changeVolume",t.stopAudio="stopAudio",t.playVideo="playVideo",t.stopVideo="stopVideo",t.click="click",t.skip="skip",t.button="button",t.trigger="trigger",t.save="save",t.load="load",t.evaluate="eval",t.link="link",t.openSaveScene="openSaveScene",t.openLoadScene="openLoadScene",t.condition="condition",t.backlog="backlog",t.removeLayer="removeLayer",t.clearCurrentVariables="clearCurrentVariables",t.clearSystemVariables="clearSystemVariables",t.fadeIn="fadeIn",t.fadeOut="fadeOut",t.timeout="timeout",t.ifElse="ifElse",t.exception="exception",t.slider="slider",t.autoMode="autoMode"}(e.Tag||(e.Tag={}));!function(t){t.system="system",t.background="background",t.choice="choice",t.message="message",t.backlog="backlog"}(e.Layer||(e.Layer={}));!function(t){t.selectedFont="selectedFont",t.autoMode="autoMode",t.autoMilliSeconds="autoMilliSeconds"}(e.BuiltinVariable||(e.BuiltinVariable={}));!function(t){t.builtin="builtin",t.system="system",t.current="current"}(e.VariableType||(e.VariableType={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=function(){function t(t){this.index=0,this.scenes=t,this.onLoaded=new g.Trigger,this.log=[]}return t.load=function(t){return g._require(t,"scenario")},Object.defineProperty(t.prototype,"backlog",{get:function(){return this.log},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){if(this.index<this.scenes.length)return this.scenes[this.index];throw new n.GameError("scene not found",{index:this.index})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frame",{get:function(){return this.scene.frame},enumerable:!0,configurable:!0}),t.prototype.update=function(t){var e=this.scenes.findIndex(function(e){return e.label===t.label});if(!(e>-1))throw new n.GameError("scene not found",t);this.index=e,this.scenes[this.index].reset(t.frame)},t.prototype.load=function(t){var e=t||this.frame;if(!e)throw new n.GameError("target frame not found");this.onLoaded.fire(e)},t.prototype.next=function(){this.load(this.scene.next())},t.prototype.findScene=function(t){return this.scenes.find(function(e){return e.label===t.label})},t.prototype.clear=function(){this.log=[],this.onLoaded.removeAll()},t.prototype.pushLog=function(t){this.log.push(t)},t}();e.Scenario=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.index=0,this._label=t.label,this.frames=t.frames}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frame",{get:function(){return this.index<this.frames.length?this.frames[this.index]:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"assetIds",{get:function(){if(!this.cacheAssetIds){this.cacheAssetIds=[];for(var t=0,e=this.frames;t<e.length;t++){var i=e[t];this.cacheAssetIds=this.cacheAssetIds.concat(i.assetIds)}}return this.cacheAssetIds},enumerable:!0,configurable:!0}),t.prototype.next=function(){return this.index<this.frames.length?(this.index++,this.frames[this.index]):void 0},t.prototype.reset=function(t){this.index=t||0},t.prototype.createSaveData=function(t,e){var i={label:this._label,frame:this.index,variables:t};return e&&(i.description=e),i},t}();e.Scene=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(2),r=function(){function t(t,e){this._scripts=t,this.alreadyRead=!!e}return Object.defineProperty(t.prototype,"scripts",{get:function(){return this._scripts},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"assetIds",{get:function(){return this.cacheAssetIds||(this.cacheAssetIds=n.collectAssetIds(this._scripts)),this.cacheAssetIds},enumerable:!0,configurable:!0}),t}();e.Frame=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0);e.defaultConfig={window:{message:{layer:{name:n.Layer.message,x:10,y:10},width:g.game.width-20,height:g.game.height-20,touchable:!0},system:[]},font:{list:[new g.DynamicFont({game:g.game,fontFamily:g.FontFamily.SansSerif,size:18})],color:"black",alreadyReadColor:"#4444FF"},system:{maxSaveCount:100,autoMessageSpeed:1500,alreadyRead:!1},audio:{voice:.5,se:.5,bgm:.5}}},function(t,e,i){var n=i(9),r=i(37),o=function(){function t(t,e){this._target=t,this._stepIndex=0,this._loop=!!e&&!!e.loop,this._modifiedHandler=e&&e.modified?e.modified:void 0,this._destroyedHandler=e&&e.destroyed?e.destroyed:void 0,this._steps=[],this._lastStep=void 0,this._pararel=!1,this.paused=!1}return t.prototype.to=function(t,e,i){void 0===i&&(i=n.linear);var o={input:t,duration:e,easing:i,type:r.TweenTo,initialized:!1};return this._push(o),this},t.prototype.by=function(t,e,i,o){void 0===i&&(i=n.linear),void 0===o&&(o=!1);var a={input:t,duration:e,easing:i,type:o?r.TweenByMult:r.TweenBy,initialized:!1};return this._push(a),this},t.prototype.con=function(){return this._pararel=!0,this},t.prototype.wait=function(t){var e={duration:t,type:r.Wait,initialized:!1};return this._push(e),this},t.prototype.call=function(t){var e={func:t,type:r.Call,duration:0,initialized:!1};return this._push(e),this},t.prototype.pause=function(){var t=this;return this.call(function(){t.paused=!0})},t.prototype.cue=function(t){var e=Object.keys(t);e.sort(function(t,e){return Number(t)>Number(e)?1:-1});for(var i=[],n=0;n<e.length;++n)i.push({time:Number(e[n]),func:t[e[n]]});var o={type:r.Cue,duration:Number(e[e.length-1]),cue:i,initialized:!1};return this._push(o),this},t.prototype.every=function(t,e,i){void 0===i&&(i=n.linear);var o={func:t,type:r.Every,easing:i,duration:e,initialized:!1};return this._push(o),this},t.prototype.fadeIn=function(t,e){return void 0===e&&(e=n.linear),this.to({opacity:1},t,e)},t.prototype.fadeOut=function(t,e){return void 0===e&&(e=n.linear),this.to({opacity:0},t,e)},t.prototype.moveTo=function(t,e,i,r){return void 0===r&&(r=n.linear),this.to({x:t,y:e},i,r)},t.prototype.moveBy=function(t,e,i,r){return void 0===r&&(r=n.linear),this.by({x:t,y:e},i,r)},t.prototype.moveX=function(t,e,i){return void 0===i&&(i=n.linear),this.to({x:t},e,i)},t.prototype.moveY=function(t,e,i){return void 0===i&&(i=n.linear),this.to({y:t},e,i)},t.prototype.rotateTo=function(t,e,i){return void 0===i&&(i=n.linear),this.to({angle:t},e,i)},t.prototype.rotateBy=function(t,e,i){return void 0===i&&(i=n.linear),this.by({angle:t},e,i)},t.prototype.scaleTo=function(t,e,i,r){return void 0===r&&(r=n.linear),this.to({scaleX:t,scaleY:e},i,r)},t.prototype.scaleBy=function(t,e,i,r){return void 0===r&&(r=n.linear),this.by({scaleX:t,scaleY:e},i,r,!0)},t.prototype.destroyed=function(){var t=!1;return this._destroyedHandler&&(t=this._destroyedHandler.call(this._target)),t||(t=this._stepIndex>=this._steps.length&&!this._loop),t},t.prototype._fire=function(t){if(0!==this._steps.length&&!this.destroyed()&&!this.paused){if(this._stepIndex>=this._steps.length){if(!this._loop)return;this._stepIndex=0}for(var e=this._steps[this._stepIndex],i=!1,n=0;n<e.length;++n){var o=e[n];if(o.initialized||this._initAction(o),!o.finished){switch(o.elapsed+=t,o.type){case r.Call:o.func.call(this._target);break;case r.Every:var a=o.easing(o.elapsed,0,1,o.duration);a>1&&(a=1),o.func.call(this._target,o.elapsed,a);break;case r.TweenTo:case r.TweenBy:case r.TweenByMult:for(var s=Object.keys(o.goal),h=0;h<s.length;++h){var u=s[h];o.elapsed>=o.duration?this._target[u]=o.goal[u]:this._target[u]=o.easing(o.elapsed,o.start[u],o.goal[u]-o.start[u],o.duration)}break;case r.Cue:var c=o.cue[o.cueIndex];void 0!==c&&o.elapsed>=c.time&&(c.func.call(this._target),++o.cueIndex)}this._modifiedHandler&&this._modifiedHandler.call(this._target),o.elapsed>=o.duration?o.finished=!0:i=!0}}if(!i){for(var l=0;l<e.length;++l)e[l].initialized=!1;++this._stepIndex}}},t.prototype.serializeState=function(){for(var t={_stepIndex:this._stepIndex,_steps:[]},e=0;e<this._steps.length;++e){t._steps[e]=[];for(var i=0;i<this._steps[e].length;++i)t._steps[e][i]={input:this._steps[e][i].input,start:this._steps[e][i].start,goal:this._steps[e][i].goal,duration:this._steps[e][i].duration,elapsed:this._steps[e][i].elapsed,type:this._steps[e][i].type,cueIndex:this._steps[e][i].cueIndex,initialized:this._steps[e][i].initialized,finished:this._steps[e][i].finished}}return t},t.prototype.deserializeState=function(t){this._stepIndex=t._stepIndex;for(var e=0;e<t._steps.length;++e)for(var i=0;i<t._steps[e].length;++i)t._steps[e][i]&&this._steps[e][i]&&(this._steps[e][i].input=t._steps[e][i].input,this._steps[e][i].start=t._steps[e][i].start,this._steps[e][i].goal=t._steps[e][i].goal,this._steps[e][i].duration=t._steps[e][i].duration,this._steps[e][i].elapsed=t._steps[e][i].elapsed,this._steps[e][i].type=t._steps[e][i].type,this._steps[e][i].cueIndex=t._steps[e][i].cueIndex,this._steps[e][i].initialized=t._steps[e][i].initialized,this._steps[e][i].finished=t._steps[e][i].finished)},t.prototype._push=function(t){if(this._pararel)this._lastStep.push(t);else{var e=this._steps.push([t])-1;this._lastStep=this._steps[e]}this._pararel=!1},t.prototype._initAction=function(t){if(t.elapsed=0,t.start={},t.goal={},t.cueIndex=0,t.finished=!1,t.initialized=!0,t.type===r.TweenTo||t.type===r.TweenBy||t.type===r.TweenByMult)for(var e=Object.keys(t.input),i=0;i<e.length;++i){var n=e[i];void 0!==this._target[n]&&(t.start[n]=this._target[n],t.type===r.TweenTo?t.goal[n]=t.input[n]:t.type===r.TweenBy?t.goal[n]=t.start[n]+t.input[n]:t.type===r.TweenByMult&&(t.goal[n]=t.start[n]*t.input[n]))}},t}();t.exports=o},function(t,e){var i;!function(t){t.linear=function(t,e,i,n){return i*t/n+e},t.easeInQuad=function(t,e,i,n){return t/=n,i*t*t+e},t.easeOutQuad=function(t,e,i,n){return t/=n,-i*t*(t-2)+e},t.easeInOutQuad=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:(--t,-i/2*(t*(t-2)-1)+e)},t.easeInQubic=function(t,e,i,n){return t/=n,i*t*t*t+e},t.easeOutQubic=function(t,e,i,n){return t/=n,--t,i*(t*t*t+1)+e},t.easeInOutQubic=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:(t-=2,i/2*(t*t*t+2)+e)},t.easeInQuart=function(t,e,i,n){return t/=n,i*t*t*t*t+e},t.easeOutQuart=function(t,e,i,n){return t/=n,--t,-i*(t*t*t*t-1)+e},t.easeInQuint=function(t,e,i,n){return t/=n,i*t*t*t*t*t+e},t.easeOutQuint=function(t,e,i,n){return t/=n,--t,i*(t*t*t*t*t+1)+e},t.easeInOutQuint=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:(t-=2,i/2*(t*t*t*t*t+2)+e)},t.easeInSine=function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},t.easeOutSine=function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},t.easeInOutSine=function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},t.easeInExpo=function(t,e,i,n){return i*Math.pow(2,10*(t/n-1))+e},t.easeInOutExpo=function(t,e,i,n){return(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:(--t,i/2*(2-Math.pow(2,-10*t))+e)},t.easeInCirc=function(t,e,i,n){return t/=n,-i*(Math.sqrt(1-t*t)-1)+e},t.easeOutCirc=function(t,e,i,n){return t/=n,--t,i*Math.sqrt(1-t*t)+e},t.easeInOutCirc=function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:(t-=2,i/2*(Math.sqrt(1-t*t)+1)+e)}}(i||(i={})),t.exports=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=i(7),o=i(11),a=i(44),s=i(24),h=i(19),u=function(){function t(e){this.game=e;var i=g._require(e,"config");i&&(t._config=i)}return Object.defineProperty(t.prototype,"config",{set:function(e){t._config=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"scriptManager",{get:function(){return t._scriptManager},enumerable:!0,configurable:!0}),Object.defineProperty(t,"config",{get:function(){return t._config},enumerable:!0,configurable:!0}),t.prototype.start=function(e){var i=e||n.Scenario.load(this.game),r=h.createStorageKeys(t.player,t._config.system.maxSaveCount),a=new o.SceneController({game:this.game,scenario:i,scriptManager:t.scriptManager,config:t.config,player:t.player,storageKeys:r});return a.start(),a},t.prototype.script=function(e,i){t.scriptManager.register(e,i)},t._scriptManager=new a.ScriptManager(s.defaultScripts),t._config=r.defaultConfig,t.player={id:"0"},t}();e.Engine=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=i(12),o=i(21),a=function(){function t(t){var e=this;this.game=t.game,this.scenario=t.scenario,this.scriptManager=t.scriptManager,this.config=t.config,this.player=t.player,this.storageKeys=t.storageKeys,this._current=new r.GameScene({game:this.game,scenario:this.scenario,scriptManager:this.scriptManager,config:this.config,controller:this,player:this.player,storageKeys:this.storageKeys}),this._current.loaded.addOnce(function(){e.saveLoadScene=new o.SaveLoadScene({game:e.game,scene:e.scenario.scene,config:e.config,assetIds:e.collectAssetIds(),gameState:e.current.gameState}),e.saveLoadScene.prefetch()},this)}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backlog",{get:function(){return this.scenario.backlog},enumerable:!0,configurable:!0}),t.prototype.start=function(){var t=this.game.scene();t!==this._current&&t!==this.saveLoadScene&&this.game.pushScene(this._current)},t.prototype.jump=function(t){var e=this.scenario.scene.label;this.scenario.update(t),e===this.scenario.scene.label?this.scenario.load():this.loadScene()},t.prototype.save=function(t){this.current.save(this.current.source,t)},t.prototype.load=function(t){var e=this.current.load(t.index);if(!e)throw new n.GameError("save data not found",t);this.jump(e)},t.prototype.openSaveLoadScene=function(){return this.game.pushScene(this.saveLoadScene),this.saveLoadScene},t.prototype.closeSaveLoadScene=function(){this.saveLoadScene.close()},t.prototype.destroy=function(){var t=this,e=this.game.scene(),i=this._current;e===this.saveLoadScene?(this.saveLoadScene.stateChanged.add(function(e){e===g.SceneState.Destroyed&&t.game.scene()===i&&t.game.popScene()},this),this.game.popScene()):this.saveLoadScene.destroyed()||this.destroy(),this.saveLoadScene=void 0,e===i&&this.game.popScene(),this._current=void 0,this.player=void 0,this.scenario=void 0,this.config=void 0,this.scriptManager=void 0,this.storageKeys=void 0,this.game=void 0},t.prototype.destroyed=function(){return!this._current},t.prototype.loadScene=function(){var t=this;this.scenario.clear();var e=this.saveLoadScene,i=this._current;switch(this._current=new r.GameScene({game:this.game,scenario:this.scenario,scriptManager:this.scriptManager,config:this.config,controller:this,player:this.player,storageKeys:this.storageKeys,state:this._current.gameState}),this._current.loaded.addOnce(function(){t.saveLoadScene=new o.SaveLoadScene({game:t.game,scene:t.scenario.scene,config:t.config,assetIds:t.collectAssetIds(),gameState:t.current.gameState}),t.saveLoadScene.prefetch()},this),e.stateChanged.add(function(e){e===g.SceneState.Destroyed&&t.game.replaceScene(t._current)},this),e.state){case g.SceneState.Standby:e.destroy();break;case g.SceneState.Active:i.setTimeout(function(){return e.destroy()},this.game.fps,this)}},t.prototype.collectAssetIds=function(){return this._current.gameState.collectAssetIds(this.scenario)},t}();e.SceneController=a},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i(39),o=i(0),a=i(14),s=i(42),h=i(43),u=i(18),c=i(19),l=function(t){function e(i){var n=t.call(this,{game:i.game,assetIds:e.collectAssetIds(i),storageKeys:i.storageKeys})||this;return n.layerGroup=new s.LayerGroup(n),n.scriptManager=i.scriptManager,n.config=i.config,n.controller=i.controller,n.audioGroup=new h.AudioGroup(n.game,i.config.audio),n.videos=[],n.player=i.player,n.storageKeys=i.storageKeys,i.state&&(n._gameState=i.state),n.loaded.add(n.onLoaded,n),n.scenario=i.scenario,n.scenario.onLoaded.add(n.loadFrame,n),n}return n(e,t),Object.defineProperty(e.prototype,"source",{get:function(){return this.scenario.scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameState",{get:function(){return this._gameState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabledWindowClick",{get:function(){return this._enabledWindowClick},enumerable:!0,configurable:!0}),e.prototype.appendLayer=function(t,e){this.layerGroup.append(t,e)},e.prototype.removeLayer=function(t){this.layerGroup.remove(t)},e.prototype.updateText=function(t){var e=this;this._message.updateText(t,this.scenario.frame.alreadyRead),this._message.onFinished.addOnce(function(t){e.scenario.pushLog({text:t,frame:e.scenario.frame}),e.scenario.frame.alreadyRead=!0,e.scriptManager.call(e.controller,{tag:o.Tag.autoMode,data:{}})},this),this.disableWindowClick(),this.enableWindowClick()},e.prototype.applyLayerConfig=function(t){this.layerGroup.applyConfig(t)},e.prototype.disableWindowClick=function(){this.disableTrigger(),this._enabledWindowClick=!1},e.prototype.enableWindowClick=function(){var t=this;this.layerGroup.evaluate(o.Layer.message,function(e){if(e.touchable=!0,t._message.finished){e.pointUp.addOnce(t.requestNextFrame,t);for(var i=0,n=e.children;i<n.length;i++){(a=n[i]).pointUp.addOnce(t.requestNextFrame,t)}}else{e.pointUp.addOnce(t.onWindowClick,t);for(var r=0,o=e.children;r<o.length;r++){var a=o[r];a.pointUp.addOnce(t.onWindowClick,t)}}}),this._enabledWindowClick=!0},e.prototype.transition=function(t,e){this.layerGroup.evaluate(t,e)},e.prototype.requestNextFrame=function(){this.disableWindowClick(),this.scenario.next()},e.prototype.playAudio=function(t){var e=this.assets[t.assetId].play();this.audioGroup.add(t.group,e)},e.prototype.changeVolume=function(t){this.audioGroup.changeVolume(t.groupName,t.volume)},e.prototype.stopAudio=function(t){this.audioGroup.remove(t)},e.prototype.playVideo=function(t){var e=this.assets[t.assetId];e.play(),this.videos.push(e)},e.prototype.stopVideo=function(t){var e=this.videos.findIndex(function(e){return e.id===t.assetId});if(!(e>0))throw new o.GameError("video not found",t);var i=this.videos[e];i.stop(),i.destroy(),this.videos.splice(e,1)},e.prototype.save=function(t,e){this.storage.save(t,e)},e.prototype.load=function(t){return this.storage.load(t)},e.prototype.setAutoTrigger=function(){var t=this;this.autoIdentifier=this.setTimeout(function(){return t.requestNextFrame()},this.gameState.variables.builtin[o.BuiltinVariable.autoMilliSeconds],this)},e.prototype.onLoaded=function(){var t=this.scenario.frame;this._gameState||(this._gameState=c.loadGameState(this,this.storageKeys,this.config)),this.storage=new r.Storage(this.game.storage,this.player,this._gameState),this.storage.saveBuiltinVariables(),this.storage.saveSystemVariables(),t?(this.removeLayers(t.scripts),this.createMessageLayer(),this.createSystemLayer(),this.applyScripts(t.scripts)):(this.createMessageLayer(),this.createSystemLayer()),this.topMessageLayer(),this.layerGroup.top(o.Layer.system)},e.prototype.disableTrigger=function(){this.autoIdentifier&&(this.clearTimeout(this.autoIdentifier),this.autoIdentifier=null),this.layerGroup.evaluate(o.Layer.message,function(t){t.touchable=!1,t.pointUp.removeAll();for(var e=0,i=t.children;e<i.length;e++){i[e].pointUp.removeAll()}})},e.prototype.loadFrame=function(t){t&&(this.removeLayers(t.scripts),this.applyScripts(t.scripts)),this.topMessageLayer(),this.layerGroup.top(o.Layer.system)},e.prototype.topMessageLayer=function(){var t=this;this.layerGroup.evaluate(o.Layer.message,function(e){e.touchable&&t.layerGroup.top(o.Layer.message)})},e.prototype.createMessageLayer=function(){this.scriptManager.call(this.controller,{tag:o.Tag.pane,data:this.config.window.message}),this._message=new a.Message({scene:this,config:this.config,width:this.game.width-40,x:this.config.window.message.layer.x+20,y:this.config.window.message.layer.y+20,gameState:this.gameState}),this.layerGroup.append(this._message,{name:o.Layer.message}),this.enableWindowClick()},e.prototype.createSystemLayer=function(){for(var t=0,e=this.config.window.system;t<e.length;t++){var i=e[t];this.scriptManager.call(this.controller,i)}},e.prototype.removeLayers=function(t){var e=this,i=new Set;t.forEach(function(t){t.data.layer&&i.add(t.data.layer)}),i.forEach(function(t){e.layerGroup.remove(t)})},e.prototype.applyScripts=function(t){var e=this;t.forEach(function(t){e.scriptManager.call(e.controller,t)})},e.collectAssetIds=function(t){var e=t.scenario.scene.assetIds.concat(o.collectAssetIds(t.config.window.system));return t.config.window.message.backgroundImage&&e.push(t.config.window.message.backgroundImage),e},e.prototype.onWindowClick=function(){this._enabledWindowClick&&(this.gameState.setValue({type:o.VariableType.builtin,name:o.BuiltinVariable.autoMode},!1),this._message.finished?this.requestNextFrame():(this._message.showAll(),this.enableWindowClick()))},e}(u.Scene);e.GameScene=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.gameId="$gameId";!function(t){t.builtin="builtin",t.system="system",t.saveDataPrefix="data"}(e.Region||(e.Region={}))},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i(40),o=i(0),a=function(t){function e(i){var n=t.call(this,e.toLabelParameters(i))||this;return n.index=0,n.counter=0,n.original={values:[]},n.current=[],n.gameState=i.gameState,n.textAlign=g.TextAlign.Left,n.config=i.config,n.onFinished=new g.Trigger,n.update.add(n.onUpdated,n),n}return n(e,t),Object.defineProperty(e.prototype,"finished",{get:function(){return this.index>=this.original.values.length},enumerable:!0,configurable:!0}),e.prototype.updateText=function(t,e){this.config.system.alreadyRead&&e?this.textColor=this.config.font.alreadyReadColor:this.textColor=this.config.font.color,t.clear?(this.text="",this.original=t,this.index=0,this.counter=0,this.setCurrent()):this.original={values:this.original.values.concat(t.values)},this.update.add(this.onUpdated,this)},e.prototype.showAll=function(){if(!this.finished){this.update.remove(this.onUpdated,this),this.text="";for(var t=0,e=this.original.values;t<e.length;t++){var i=e[t];if("string"==typeof i)this.text+=i;else if(Array.isArray(i))this.text+=i[i.length-1].value;else{var n=this.gameState.getStringValue(i);if(!n)throw new o.GameError("変数の取得に失敗しました",i);this.text+=n}}this.index=this.original.values.length,this.onFinished.fire(this.text),this.invalidate()}},e.prototype.onUpdated=function(){if(!this.finished&&this.counter>=this.current.length&&(this.counter=0,this.index++,this.finished||this.setCurrent()),!this.finished){var t=this.current[this.counter];"string"==typeof t?this.text+=t:(0!==this.counter&&(this.text=this.text.substring(0,this.text.length-t.value.length)),this.text+=t.value),this.invalidate(),this.counter++}this.finished&&(this.update.remove(this.onUpdated,this),this.onFinished.fire(this.text))},e.prototype.setCurrent=function(){var t=this.original.values[this.index];if("string"==typeof t)this.current=t.split(/.*?/);else if(Array.isArray(t))this.current=t;else{var e=this.gameState.getStringValue(t);if(!e)throw new o.GameError("変数の取得に失敗しました",t);this.current=e.split(/.*?/)}},e.toLabelParameters=function(t){var e=t.gameState.getValue({type:o.VariableType.builtin,name:o.BuiltinVariable.selectedFont}),i=t.config.font.list[e];return{scene:t.scene,font:i,text:"",fontSize:i.size,textColor:t.config.font.color,width:t.width,x:t.x,y:t.y}},e}(r.Label);e.Message=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});!function(t){t[t.Center=0]="Center",t[t.SpaceAround=1]="SpaceAround"}(e.RubyAlign||(e.RubyAlign={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e,i){this.text=t,this.width=e,this.glyphs=i}}();e.StringDrawInfo=n;var r=function(){return function(t,e,i,n,r,o){this.text=t.text,this.fragment=t,this.width=e,this.rbWidth=i,this.rtWidth=n,this.glyphs=r,this.rubyGlyphs=o}}();e.RubyFragmentDrawInfo=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parse=function(t){for(var e=/^((?:[^\\{]|\\+.)*?)({(?:[^\\}]|\\+.)*?})([\s\S]*)/,i=[];t.length>0;){var n=t.match(e);if(null===n){i.push(t.replace(/\\{/g,"{").replace(/\\}/g,"}"));break}var r=n[1],o=n[2];t=n[3],r.length>0&&i.push(r.replace(/\\{/g,"{").replace(/\\}/g,"}"));var a=JSON.parse(o.replace(/\\/g,"\\\\"));if(!a.hasOwnProperty("rt")||!a.hasOwnProperty("rb"))throw g.ExceptionFactory.createTypeMismatchError("parse","RubyFragment");a.rt=a.rt.replace(/\\{/g,"{").replace(/\\}/g,"}"),a.rb=a.rb.replace(/\\{/g,"{").replace(/\\}/g,"}"),a.text=o,i.push(a)}return i}},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(g.Scene);e.Scene=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(20),r=i(13),o=r.Region.saveDataPrefix.length;e.loadGameState=function(t,e,i){var a=i.system.maxSaveCount,s=function(t,e,i){for(var n={builtin:{},system:{},current:{}},a=[],s=0,h=e;s<h.length;s++)for(var u=h[s],c=0,l=t.storageValues.get(u);c<l.length;c++)!function(t){var e="number"==typeof t.data?t.data:JSON.parse(t.data);if(u.regionKey===r.Region.system)n.system=e;else{var i=a.find(function(e){return e.key===t.storageKey}),s=u.regionKey.split(".");if(!i){var h=parseInt(s[0].substring(o),10);i={key:t.storageKey,value:{label:"",frame:0,variables:{}}},a[h]=i}switch(s[s.length-1]){case"frame":i.value.frame=e;break;case"label":i.value.label=e;break;case"description":i.value.description=e;break;default:i.value.variables=e}}}(l[c]);return{data:a.map(function(t){return t.value}),variables:n}}(t,e);return void 0===s.variables.builtin.selectedFont&&(s.variables.builtin.selectedFont=0),void 0===s.variables.builtin.autoMode&&(s.variables.builtin.autoMode=!1),void 0===s.variables.builtin.autoMilliSeconds&&(s.variables.builtin.autoMilliSeconds=i.system.autoMessageSpeed),new n.GameState(s.data,s.variables,a)},e.createStorageKeys=function(t,e){for(var i=[{region:g.StorageRegion.Values,regionKey:r.Region.system,userId:t.id,gameId:r.gameId},{region:g.StorageRegion.Values,regionKey:r.Region.builtin,userId:t.id,gameId:r.gameId}],n=0;n<e-1;n++)i.push({region:g.StorageRegion.Values,regionKey:r.Region.saveDataPrefix+n,userId:t.id,gameId:r.gameId});return i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=function(){function t(t,e,i){this.data=t,this._variables=e,this.max=i}return Object.defineProperty(t.prototype,"variables",{get:function(){return this._variables},enumerable:!0,configurable:!0}),t.prototype.exists=function(t){return void 0!==this.data[t]},t.prototype.save=function(t,e){if(e.index>this.max||e.index<0)throw new n.GameError("storage out of range",e);var i=t.createSaveData(this._variables.current,e.description);if(e.force)return this.data[e.index]=i,i;if(this.exists(e.index))throw new n.GameError("save data already exists",e);return this.data[e.index]=i,i},t.prototype.load=function(t){var e=this.data[t];return e&&(this._variables.current=e.variables),e},t.prototype.getValue=function(t){return this.getVariables(t)[t.name]},t.prototype.getStringValue=function(t){var e=this.getValue(t);return e?String(e):void 0},t.prototype.setValue=function(t,e){this.getVariables(t)[t.name]=e},t.prototype.collectAssetIds=function(t){for(var e=[],i=0,n=this.data;i<n.length;i++){var r=n[i];e=e.concat(t.findScene(r).assetIds)}return e},t.prototype.getVariables=function(t){if(t.type===n.VariableType.system)return this._variables.system;if(t.type===n.VariableType.builtin)return this._variables.builtin;if(t.type===n.VariableType.current)return this._variables.current;throw new n.GameError("invalid variable type",t)},t}();e.GameState=r},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i(0),o=i(22),a=function(t){function e(i){var n=t.call(this,{game:i.game,assetIds:e.collectAssetIds(i)})||this;return n.config=i.config,n.gameState=i.gameState,n.loaded.add(n.onLoaded,n),n}return n(e,t),e.prototype.close=function(){if(this.game.scene()!==this)throw new r.GameError("Current scene is not a save or load scene.");this.game.popScene(!0)},e.prototype.onLoaded=function(){this.button=new o.LabelButton({scene:this,width:100,height:24,text:"close",fontSize:18,config:this.config,gameState:this.gameState}),this.button.move(this.game.width-110,10),this.button.onClick.add(this.close,this),this.append(this.button)},e.collectAssetIds=function(t){var e=t.scene.assetIds.concat(r.collectAssetIds(t.config.window.system),t.assetIds);return t.config.window.message.backgroundImage&&e.push(t.config.window.message.backgroundImage),e},e}(i(18).Scene);e.SaveLoadScene=a},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i(23),o=i(0),a=function(t){function e(e){var i=t.call(this,e)||this,n=e.gameState.getValue({type:o.VariableType.builtin,name:o.BuiltinVariable.selectedFont}),r=e.config.font.list[n],a=new g.Label({scene:i.scene,text:e.text,font:r,fontSize:e.fontSize?e.fontSize:r.size,textColor:e.config.font.color});return a.aligning(i.width,g.TextAlign.Center),a.invalidate(),i.append(a),i}return n(e,t),e.prototype.push=function(){this.y+=2,this.height-=2,t.prototype.push.call(this)},e.prototype.unpush=function(){this.y-=2,this.height+=2,t.prototype.unpush.call(this)},e}(r.Button);e.LabelButton=a},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e){var i=t.call(this,{scene:e.scene,width:e.width,height:e.height,backgroundImage:e.backgroundImage?e.scene.assets[e.backgroundImage]:void 0,padding:e.padding,backgroundEffector:e.backgroundEffector?new g.NinePatchSurfaceEffector(e.scene.game,e.backgroundEffector.borderWidth):void 0})||this;return i.touchable=!0,i.pointDown.add(i.onPointDown,i),i.pointMove.add(i.onPointMove,i),i.pointUp.add(i.onPointUp,i),i.onClick=new g.Trigger,i.pushed=!1,i}return n(e,t),e.prototype.push=function(){this.pushed=!0,this.modified()},e.prototype.unpush=function(){this.pushed=!1,this.modified()},e.prototype.move=function(t,e){this.x=t,this.y=e,this.modified()},e.prototype.onPointDown=function(t){this.pushed||this.push()},e.prototype.isHover=function(t){var e={x:t.point.x+t.startDelta.x,y:t.point.y+t.startDelta.y};return!(e.x<0||e.y<0)&&!(e.x>=this.width||e.y>=this.height)},e.prototype.onPointMove=function(t){var e=this.isHover(t);this.pushed&&!e?this.unpush():!this.pushed&&e&&this.push()},e.prototype.onPointUp=function(t){this.pushed&&(this.onClick.fire(this),this.unpush())},e}(g.Pane);e.Button=r},function(t,e,i){"use strict";function n(t,e){t.game;var i={scene:t,width:e.width,height:e.height,backgroundImage:e.backgroundImage,padding:e.padding,backgroundEffector:e.backgroundEffector,text:e.text,config:v.Engine.config,gameState:t.gameState};e.fontSize&&(i.fontSize=e.fontSize);var n=new f.LabelButton(i);return n.move(e.layer.x,e.layer.y),n}function r(t,e){for(var i=n(t.current,e),r=0,o=e.scripts;r<o.length;r++){!function(e){i.onClick.add(function(){v.Engine.scriptManager.call(t,e)})}(o[r])}t.current.appendLayer(i,e.layer)}function o(t,e){switch(e){case 1:t.current.disableWindowClick();break;case 0:t.current.enableWindowClick()}}function a(t,e){if(g._require(t.game,e.path)(t.current.gameState.variables)){for(var i=0,n=e.scripts;i<n.length;i++){var r=n[i];v.Engine.scriptManager.call(t,r)}return!0}return!1}function s(t,e){t.current.gameState.getValue({type:d.VariableType.builtin,name:d.BuiltinVariable.autoMode})&&t.current.setAutoTrigger()}function h(t,e,i){var r,o=t.openSaveLoadScene();switch(e.button){case 0:r=l.Position.Top;break;case 1:r=l.Position.Bottom}var a=new l.Pagination({scene:o,x:20,y:40,width:o.game.width-40,height:o.game.height-50,limit:{vertical:e.vertical,horizontal:e.horizontal},position:r,paddingRight:e.padding,first:!0,last:!0});o.append(a);for(var s=0;s<v.Engine.config.system.maxSaveCount;s++){for(var h={layer:e.base.layer,width:e.base.width,height:e.base.height,backgroundImage:e.base.backgroundImage,padding:e.base.padding,backgroundEffector:e.base.backgroundEffector,text:String(s),scripts:i(s)},u=n(o,h),c=0,d=h.scripts;c<d.length;c++){!function(e){u.onClick.add(function(){v.Engine.scriptManager.call(t,e)})}(d[c])}a.content.append(u)}}Object.defineProperty(e,"__esModule",{value:!0});var u=i(45),c=i(27),l=i(49),d=i(0),p=i(52),f=i(22),y=i(33),_=i(53),b=i(14),v=i(10);e.autoMode=s;var m="closeLoadScene";e.defaultScripts=new Map([[d.Tag.image,function(t,e){var i=t.current;i.appendLayer(y.createImage(i,e),e.layer),i.applyLayerConfig({name:e.layer.name,opacity:e.layer.opacity,visible:e.layer.visible})}],[d.Tag.pane,function(t,e){var i=t.current,n=new g.Pane({scene:i,width:e.width,height:e.height,x:e.layer.x,y:e.layer.y,backgroundImage:e.backgroundImage?i.assets[e.backgroundImage]:void 0,padding:e.padding,backgroundEffector:e.backgroundEffector?new g.NinePatchSurfaceEffector(i.game,e.backgroundEffector.borderWidth):void 0});n.touchable=!!e.touchable,i.appendLayer(n,e.layer)}],[d.Tag.jump,function(t,e){t.jump(e)}],[d.Tag.button,function(t,e){var i=p.ImageButton.create(t.current,e.image);i.move(e.x,e.y),i.onClick.add(function(){for(var i=0,n=e.scripts;i<n.length;i++){var r=n[i];v.Engine.scriptManager.call(t,r)}}),t.current.appendLayer(i,e.image.layer)}],[d.Tag.choice,function(t,e){for(var i=t.game,n=e.values.length,r=e.width?e.width:i.width/4*3,o=e.height?e.height:32,a=e.x?e.x:r/6,s=e.y?e.y:(i.height/3*2-o*n-10*(n-1))/2,h=0,u=0,c=e.values;u<c.length;u++)!function(n){if(n.path&&!g._require(i,n.path)(t.current.gameState.variables))return"continue";var u=new f.LabelButton({scene:t.current,width:r,height:o,backgroundImage:e.backgroundImage,padding:e.padding,backgroundEffector:e.backgroundEffector,text:n.text,config:v.Engine.config,gameState:t.current.gameState});switch(u.onClick.add(function(){v.Engine.scriptManager.call(t,n)}),e.direction?e.direction:0){case 0:u.move(a,s+(o+10)*h);break;case 1:u.move(a+(r+10)*h,s)}t.current.appendLayer(u,e.layer),h++}(c[u])}],[d.Tag.link,r],[d.Tag.text,function(t,e){t.current.updateText(e)}],[d.Tag.layerConfig,function(t,e){t.current.applyLayerConfig(e)}],[d.Tag.playAudio,function(t,e){t.current.playAudio(e)}],[d.Tag.stopAudio,function(t,e){t.current.stopAudio(e)}],[d.Tag.playVideo,function(t,e){t.current.playVideo(e)}],[d.Tag.changeVolume,function(t,e){t.current.changeVolume(e)}],[d.Tag.stopVideo,function(t,e){t.current.stopVideo(e)}],[d.Tag.click,function(t,e){var i=t.current;i.pointUpCapture.addOnce(function(){for(var i=0,n=e;i<n.length;i++){var r=n[i];v.Engine.scriptManager.call(t,r)}},i)}],[d.Tag.skip,function(t,e){t.current.requestNextFrame()}],[d.Tag.trigger,o],[d.Tag.save,function(t,e){t.save(e)}],[d.Tag.load,function(t,e){t.load(e)}],[d.Tag.evaluate,function(t,e){g._require(t.game,e.path)(t.current.gameState.variables)}],[d.Tag.condition,a],[d.Tag.backlog,function(t,e){for(var i={name:d.Layer.backlog},n=0,a=e.scripts;n<a.length;n++){var s=a[n];v.Engine.scriptManager.call(t,s)}var h=t.current,u=h.enabledWindowClick;u&&o(t,1);var l=new c.Scrollable({scene:h,x:20,y:50,width:t.game.width-50,height:t.game.height-70,vertical:!0,horizontal:!1});h.appendLayer(l,i);for(var p=new b.Message({scene:h,config:v.Engine.config,width:t.game.width-60,x:0,y:0,gameState:h.gameState}),f=[],g=0,y=t.backlog;g<y.length;g++){var _=y[g];0!==f.length?f.push("\n",_.text):f.push(_.text)}p.updateText({values:f}),p.showAll(),l.content.append(p);var m=[{tag:d.Tag.removeLayer,data:{name:i.name}}];u&&m.push({tag:d.Tag.trigger,data:0}),r(t,{layer:{name:i.name,x:t.game.width-80-10,y:20},width:80,height:24,text:"close",scripts:m})}],[d.Tag.removeLayer,function(t,e){t.current.removeLayer(e.name)}],[d.Tag.clearSystemVariables,function(t,e){t.current.gameState.variables.system={}}],[d.Tag.clearCurrentVariables,function(t,e){t.current.gameState.variables.current={}}],[d.Tag.fadeIn,function(t,e){t.current.transition(e.layer,function(i){new u.Timeline(t.current).create(i,{modified:i.modified,destroyed:i.destroyed}).fadeIn(e.duration)})}],[d.Tag.fadeOut,function(t,e){t.current.transition(e.layer,function(i){new u.Timeline(t.current).create(i,{modified:i.modified,destroyed:i.destroyed}).fadeOut(e.duration)})}],[d.Tag.timeout,function(t,e){t.current.setTimeout(function(){for(var i=0,n=e.scripts;i<n.length;i++){var r=n[i];v.Engine.scriptManager.call(t,r)}},e.milliseconds)}],[d.Tag.ifElse,function(t,e){for(var i=0,n=e.conditions;i<n.length;i++)if(a(t,n[i]))return;for(var r=0,o=e.elseBody;r<o.length;r++){var s=o[r];v.Engine.scriptManager.call(t,s)}}],[d.Tag.exception,function(t,e){e instanceof d.GameError?t.game.logger.warn(e.message,e.data):t.game.logger.warn(e.message)}],[d.Tag.slider,function(t,e){var i=new _.Slider({scene:t.current,width:0,height:0,x:e.layer.x,y:e.layer.y,data:e,state:t.current.gameState});t.current.appendLayer(i,e.layer)}],[d.Tag.autoMode,s],[m,function(t,e){t.closeSaveLoadScene()}],[d.Tag.openSaveScene,function(t,e){h(t,e,function(t){return[{tag:d.Tag.save,data:{index:t,force:!0}}]})}],[d.Tag.openLoadScene,function(t,e){h(t,e,function(t){return[{tag:m,data:{}},{tag:d.Tag.load,data:{index:t}}]})}]])},function(t,e,i){var n=i(26),r=i(47),o=function(){function t(t,e){this._target=t,this._stepIndex=0,this._loop=!!e&&!!e.loop,this._modifiedHandler=e&&e.modified?e.modified:void 0,this._destroyedHandler=e&&e.destroyed?e.destroyed:void 0,this._steps=[],this._lastStep=void 0,this._pararel=!1,this.paused=!1}return t.prototype.to=function(t,e,i){void 0===i&&(i=n.linear);var o={input:t,duration:e,easing:i,type:r.TweenTo,initialized:!1};return this._push(o),this},t.prototype.by=function(t,e,i,o){void 0===i&&(i=n.linear),void 0===o&&(o=!1);var a={input:t,duration:e,easing:i,type:o?r.TweenByMult:r.TweenBy,initialized:!1};return this._push(a),this},t.prototype.con=function(){return this._pararel=!0,this},t.prototype.wait=function(t){var e={duration:t,type:r.Wait,initialized:!1};return this._push(e),this},t.prototype.call=function(t){var e={func:t,type:r.Call,duration:0,initialized:!1};return this._push(e),this},t.prototype.pause=function(){var t=this;return this.call(function(){t.paused=!0})},t.prototype.cue=function(t){var e=Object.keys(t);e.sort(function(t,e){return Number(t)>Number(e)?1:-1});for(var i=[],n=0;n<e.length;++n)i.push({time:Number(e[n]),func:t[e[n]]});var o={type:r.Cue,duration:Number(e[e.length-1]),cue:i,initialized:!1};return this._push(o),this},t.prototype.every=function(t,e,i){void 0===i&&(i=n.linear);var o={func:t,type:r.Every,easing:i,duration:e,initialized:!1};return this._push(o),this},t.prototype.fadeIn=function(t,e){return void 0===e&&(e=n.linear),this.to({opacity:1},t,e)},t.prototype.fadeOut=function(t,e){return void 0===e&&(e=n.linear),this.to({opacity:0},t,e)},t.prototype.moveTo=function(t,e,i,r){return void 0===r&&(r=n.linear),this.to({x:t,y:e},i,r)},t.prototype.moveBy=function(t,e,i,r){return void 0===r&&(r=n.linear),this.by({x:t,y:e},i,r)},t.prototype.moveX=function(t,e,i){return void 0===i&&(i=n.linear),this.to({x:t},e,i)},t.prototype.moveY=function(t,e,i){return void 0===i&&(i=n.linear),this.to({y:t},e,i)},t.prototype.rotateTo=function(t,e,i){return void 0===i&&(i=n.linear),this.to({angle:t},e,i)},t.prototype.rotateBy=function(t,e,i){return void 0===i&&(i=n.linear),this.by({angle:t},e,i)},t.prototype.scaleTo=function(t,e,i,r){return void 0===r&&(r=n.linear),this.to({scaleX:t,scaleY:e},i,r)},t.prototype.scaleBy=function(t,e,i,r){return void 0===r&&(r=n.linear),this.by({scaleX:t,scaleY:e},i,r,!0)},t.prototype.destroyed=function(){var t=!1;return this._destroyedHandler&&(t=this._destroyedHandler.call(this._target)),t||(t=this._stepIndex>=this._steps.length&&!this._loop),t},t.prototype._fire=function(t){if(0!==this._steps.length&&!this.destroyed()&&!this.paused){if(this._stepIndex>=this._steps.length){if(!this._loop)return;this._stepIndex=0}for(var e=this._steps[this._stepIndex],i=!1,n=0;n<e.length;++n){var o=e[n];if(o.initialized||this._initAction(o),!o.finished){switch(o.elapsed+=t,o.type){case r.Call:o.func.call(this._target);break;case r.Every:var a=o.easing(o.elapsed,0,1,o.duration);a>1&&(a=1),o.func.call(this._target,o.elapsed,a);break;case r.TweenTo:case r.TweenBy:case r.TweenByMult:for(var s=Object.keys(o.goal),h=0;h<s.length;++h){var u=s[h];o.elapsed>=o.duration?this._target[u]=o.goal[u]:this._target[u]=o.easing(o.elapsed,o.start[u],o.goal[u]-o.start[u],o.duration)}break;case r.Cue:var c=o.cue[o.cueIndex];void 0!==c&&o.elapsed>=c.time&&(c.func.call(this._target),++o.cueIndex)}this._modifiedHandler&&this._modifiedHandler.call(this._target),o.elapsed>=o.duration?o.finished=!0:i=!0}}if(!i){for(var l=0;l<e.length;++l)e[l].initialized=!1;++this._stepIndex}}},t.prototype.serializeState=function(){for(var t={_stepIndex:this._stepIndex,_steps:[]},e=0;e<this._steps.length;++e){t._steps[e]=[];for(var i=0;i<this._steps[e].length;++i)t._steps[e][i]={input:this._steps[e][i].input,start:this._steps[e][i].start,goal:this._steps[e][i].goal,duration:this._steps[e][i].duration,elapsed:this._steps[e][i].elapsed,type:this._steps[e][i].type,cueIndex:this._steps[e][i].cueIndex,initialized:this._steps[e][i].initialized,finished:this._steps[e][i].finished}}return t},t.prototype.deserializeState=function(t){this._stepIndex=t._stepIndex;for(var e=0;e<t._steps.length;++e)for(var i=0;i<t._steps[e].length;++i)t._steps[e][i]&&this._steps[e][i]&&(this._steps[e][i].input=t._steps[e][i].input,this._steps[e][i].start=t._steps[e][i].start,this._steps[e][i].goal=t._steps[e][i].goal,this._steps[e][i].duration=t._steps[e][i].duration,this._steps[e][i].elapsed=t._steps[e][i].elapsed,this._steps[e][i].type=t._steps[e][i].type,this._steps[e][i].cueIndex=t._steps[e][i].cueIndex,this._steps[e][i].initialized=t._steps[e][i].initialized,this._steps[e][i].finished=t._steps[e][i].finished)},t.prototype._push=function(t){if(this._pararel)this._lastStep.push(t);else{var e=this._steps.push([t])-1;this._lastStep=this._steps[e]}this._pararel=!1},t.prototype._initAction=function(t){if(t.elapsed=0,t.start={},t.goal={},t.cueIndex=0,t.finished=!1,t.initialized=!0,t.type===r.TweenTo||t.type===r.TweenBy||t.type===r.TweenByMult)for(var e=Object.keys(t.input),i=0;i<e.length;++i){var n=e[i];void 0!==this._target[n]&&(t.start[n]=this._target[n],t.type===r.TweenTo?t.goal[n]=t.input[n]:t.type===r.TweenBy?t.goal[n]=t.start[n]+t.input[n]:t.type===r.TweenByMult&&(t.goal[n]=t.start[n]*t.input[n]))}},t}();t.exports=o},function(t,e){var i;!function(t){t.linear=function(t,e,i,n){return i*t/n+e},t.easeInQuad=function(t,e,i,n){return t/=n,i*t*t+e},t.easeOutQuad=function(t,e,i,n){return t/=n,-i*t*(t-2)+e},t.easeInOutQuad=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:(--t,-i/2*(t*(t-2)-1)+e)},t.easeInQubic=function(t,e,i,n){return t/=n,i*t*t*t+e},t.easeOutQubic=function(t,e,i,n){return t/=n,--t,i*(t*t*t+1)+e},t.easeInOutQubic=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:(t-=2,i/2*(t*t*t+2)+e)},t.easeInQuart=function(t,e,i,n){return t/=n,i*t*t*t*t+e},t.easeOutQuart=function(t,e,i,n){return t/=n,--t,-i*(t*t*t*t-1)+e},t.easeInQuint=function(t,e,i,n){return t/=n,i*t*t*t*t*t+e},t.easeOutQuint=function(t,e,i,n){return t/=n,--t,i*(t*t*t*t*t+1)+e},t.easeInOutQuint=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:(t-=2,i/2*(t*t*t*t*t+2)+e)},t.easeInSine=function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},t.easeOutSine=function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},t.easeInOutSine=function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},t.easeInExpo=function(t,e,i,n){return i*Math.pow(2,10*(t/n-1))+e},t.easeInOutExpo=function(t,e,i,n){return(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:(--t,i/2*(2-Math.pow(2,-10*t))+e)},t.easeInCirc=function(t,e,i,n){return t/=n,-i*(Math.sqrt(1-t*t)-1)+e},t.easeOutCirc=function(t,e,i,n){return t/=n,--t,i*Math.sqrt(1-t*t)+e},t.easeInOutCirc=function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:(t-=2,i/2*(Math.sqrt(1-t*t)+1)+e)}}(i||(i={})),t.exports=i},function(t,e,i){"use strict";function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}n(i(28)),n(i(29)),n(i(30)),n(i(31));var r=i(48);e.Scrollable=r.Scrollable,e.internal={ScrolledContentContainer:r.ScrolledContentContainer,ScrolledContent:r.ScrolledContent}},function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=function(t){function e(e){var i=t.call(this,{scene:e.scene,width:0,height:e.bgImage?e.bgImage.height:e.image.height,backgroundImage:e.bgImage,backgroundEffector:e.bgImage&&new g.NinePatchSurfaceEffector(e.scene.game,Math.floor(e.bgImage.height/2)),touchable:!0})||this;return i.onChangeBarPositionRate=new g.Trigger,i._bar=new g.Pane({scene:e.scene,parent:i,width:0,height:e.bgImage?e.bgImage.height:e.image.height,backgroundImage:e.image,backgroundEffector:new g.NinePatchSurfaceEffector(e.scene.game,Math.floor(e.image.height/2)),touchable:!0}),i._barImage=e.image,i._contentLength=0,i._deltaOrigin=0,i._delta=0,i.pointDown.add(i._handlePointDown,i),i._bar.pointDown.add(i._handleBarPointDown,i),i._bar.pointMove.add(i._handleBarPointMove,i),i}return n(e,t),e.prototype.destroy=function(){this.onChangeBarPositionRate.destroy(),this.onChangeBarPositionRate=null,this._bar=null,this._barImage=null,this._contentLength=0,t.prototype.destroy.call(this)},e.prototype.setBarProperties=function(t,e,i){null!=e&&this._contentLength!==e&&(this._contentLength=e),null!=i&&this.width!==i&&(this.width=i,this.invalidate());var n=0;this.width<this._contentLength&&(n=Math.floor(Math.max(this.width*this.width/this._contentLength,this._barImage.width)));var r=Math.floor(Math.max(t*this.width));this._bar.width!==n&&(this._bar.width=n,this._bar.invalidate()),this._bar.x!==r&&(this._bar.x=r,this._bar.modified(),this._deltaOrigin=this._bar.x,this._delta=0)},e.prototype._handlePointDown=function(t){t.point.x<this._bar.x?this._changePositionRate(this._bar.x-this._bar.width):t.point.x>this._bar.x+this._bar.width&&this._changePositionRate(this._bar.x+this._bar.width)},e.prototype._handleBarPointDown=function(t){this._deltaOrigin=this._bar.x,this._delta=0},e.prototype._handleBarPointMove=function(t){this._delta+=t.prevDelta.x,this._changePositionRate(this._deltaOrigin+this._delta)},e.prototype._changePositionRate=function(t){var e=this.width-this._bar.width,i=Math.min(Math.max(t,0),e);this._bar.x!==i&&(this._bar.x=i,this._bar.modified(),this.onChangeBarPositionRate.fire(i/this.width))},e}(g.Pane);e.NinePatchHorizontalScrollbar=r},function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=function(t){function e(e){var i=t.call(this,{scene:e.scene,width:e.bgImage?e.bgImage.width:e.image.width,height:0,backgroundImage:e.bgImage,backgroundEffector:e.bgImage&&new g.NinePatchSurfaceEffector(e.scene.game,Math.floor(e.bgImage.width/2)),touchable:!0})||this;return i.onChangeBarPositionRate=new g.Trigger,i._bar=new g.Pane({scene:e.scene,parent:i,width:e.bgImage?e.bgImage.width:e.image.width,height:0,backgroundImage:e.image,backgroundEffector:new g.NinePatchSurfaceEffector(e.scene.game,Math.floor(e.image.width/2)),touchable:!0}),i._barImage=e.image,i._contentLength=0,i._deltaOrigin=0,i._delta=0,i.pointDown.add(i._handlePointDown,i),i._bar.pointDown.add(i._handleBarPointDown,i),i._bar.pointMove.add(i._handleBarPointMove,i),i}return n(e,t),e.prototype.destroy=function(){this.onChangeBarPositionRate.destroy(),this.onChangeBarPositionRate=null,this._bar=null,this._barImage=null,this._contentLength=0,t.prototype.destroy.call(this)},e.prototype.setBarProperties=function(t,e,i){null!=e&&this._contentLength!==e&&(this._contentLength=e),null!=i&&this.height!==i&&(this.height=i,this.invalidate());var n=0;this.height<this._contentLength&&(n=Math.floor(Math.max(this.height*this.height/this._contentLength,this._barImage.height)));var r=Math.floor(Math.max(t*this.height));this._bar.height!==n&&(this._bar.height=n,this._bar.invalidate()),this._bar.y!==r&&(this._bar.y=r,this._bar.modified(),this._deltaOrigin=this._bar.y,this._delta=0)},e.prototype._handlePointDown=function(t){t.point.y<this._bar.y?this._changePositionRate(this._bar.y-this._bar.height):t.point.y>this._bar.y+this._bar.height&&this._changePositionRate(this._bar.y+this._bar.height)},e.prototype._handleBarPointDown=function(t){this._deltaOrigin=this._bar.y,this._delta=0},e.prototype._handleBarPointMove=function(t){this._delta+=t.prevDelta.y,this._changePositionRate(this._deltaOrigin+this._delta)},e.prototype._changePositionRate=function(t){var e=this.height-this._bar.height,i=Math.min(Math.max(t,0),e);this._bar.y!==i&&(this._bar.y=i,this._bar.modified(),this.onChangeBarPositionRate.fire(i/this.height))},e}(g.Pane);e.NinePatchVerticalScrollbar=r},function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=function(t){function e(e){var i=t.call(this,e)||this;return i.onChangeBarPositionRate=new g.Trigger,i}return n(e,t),e.prototype.destroy=function(){this.onChangeBarPositionRate.destroy(),this.onChangeBarPositionRate=null,t.prototype.destroy.call(this)},e.prototype.setBarProperties=function(t,e,i){},e}(g.E);e.NullScrollbar=r},function(t,e,i){"use strict";function n(t,e,i,n,r){for(var o=i-n;o<=i+n;++o){var a=n*Math.cos(Math.asin((i-o)/n));t.fillRect(e-a,o,2*a,1,r)}}e.drawCircle=n,e.createDefaultScrollbarImage=function(t,e,i,r,o){var a=t.resourceFactory.createSurface(2*e+1,2*e+1),s=a.renderer();return s.begin(),n(s,e,e,e,i),n(s,e,e,r,o),s.end(),a}},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(e){var i=t.call(this,{scene:e.scene,width:e.width,height:e.image.height,backgroundImage:e.image,backgroundEffector:e.image&&new g.NinePatchSurfaceEffector(e.scene.game),touchable:!0})||this;i.onClick=new g.Trigger;var n=e.font?e.font:new g.DynamicFont({game:e.scene.game,fontFamily:g.FontFamily.SansSerif,size:15});return i.label=new g.Label({scene:e.scene,font:n,text:e.text,fontSize:e.fontSize?e.fontSize:18,textColor:"white"}),i.label.aligning(i.width,g.TextAlign.Center),i.label.invalidate(),i.append(i.label),i.pointUp.add(i.onPointUp,i),i}return n(e,t),e.prototype.destroy=function(){this.onClick.destroy(),this.onClick=null,this.label=null,t.prototype.destroy.call(this)},e.prototype.onPointUp=function(t){this.onClick.fire()},e}(g.Pane);e.LabelButton=r},function(t,e,i){"use strict";function n(t,e,i){var n=new g.FrameSprite({scene:t,src:e,width:i.frame.width,height:i.frame.height});return n.frames=i.frame.frames,void 0!==i.frame.interval&&(n.interval=i.frame.interval),n.start(),n}Object.defineProperty(e,"__esModule",{value:!0}),e.createFrameSprite=n,e.createImage=function(t,e){var i,r=t.assets[e.assetId];return i=e.frame?n(t,r,e):new g.Sprite({scene:t,src:r}),void 0!==e.layer.x&&(i.x=e.layer.x),void 0!==e.layer.y&&(i.y=e.layer.y),i.invalidate(),i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(35),r=i(0),o=i(38);t.exports=function(){o.engine.script("logo",function(t,e){var i=t.current;i.transition(e.layer,function(t){new n.Timeline(i).create(t,{modified:t.modified,destroyed:t.destroyed}).fadeIn(e.duration).wait(e.wait).fadeOut(e.duration).call(function(){return i.requestNextFrame()})})});var t=o.defaultScripts.get(r.Tag.choice);o.engine.script(r.Tag.choice,function(e,i){i.backgroundImage="pane",i.padding=4,i.backgroundEffector={borderWidth:4},t(e,i)}),o.engine.start()}},function(t,e,i){e.Timeline=i(36),e.Tween=i(8),e.Easing=i(9)},function(t,e,i){var n=i(8),r=function(){function t(t){this._scene=t,this._tweens=[],this._fps=this._scene.game.fps,this.paused=!1,t.update.handle(this,this._handler)}return t.prototype.create=function(t,e){var i=new n(t,e);return this._tweens.push(i),i},t.prototype.remove=function(t){var e=this._tweens.indexOf(t);e<0||this._tweens.splice(e,1)},t.prototype.clear=function(){this._tweens.length=0},t.prototype.destroy=function(){this._tweens.length=0,this._scene.destroyed()||this._scene.update.remove(this,this._handler),this._scene=void 0},t.prototype.destroyed=function(){return void 0===this._scene},t.prototype._handler=function(){if(0!==this._tweens.length&&!this.paused){for(var t=[],e=0;e<this._tweens.length;++e){var i=this._tweens[e];i.destroyed()||(i._fire(1e3/this._fps),t.push(i))}this._tweens=t}},t}();t.exports=r},function(t,e){var i;!function(t){t[t.Wait=0]="Wait",t[t.Call=1]="Call",t[t.TweenTo=2]="TweenTo",t[t.TweenBy=3]="TweenBy",t[t.TweenByMult=4]="TweenByMult",t[t.Cue=5]="Cue",t[t.Every=6]="Every"}(i||(i={})),t.exports=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),r=i(24);e.defaultScripts=r.defaultScripts,function(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}(i(20));var o=i(11);e.SceneController=o.SceneController;var a=i(12);e.GameScene=a.GameScene;var s=i(21);e.SaveLoadScene=s.SaveLoadScene,e.engine=new n.Engine(g.game)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(13),r=function(){function t(t,e,i){this.storage=t,this.player=e,this.state=i}return t.prototype.load=function(t){return this.state.load(t)},t.prototype.save=function(t,e){var i=this.state.save(t,e),r=n.Region.saveDataPrefix+e.index+".";this.write(i.variables,r+"variables"),this.write(i.label,r+"label"),this.write(i.frame,r+"frame"),i.description&&this.write(i.description,r+"description")},t.prototype.saveBuiltinVariables=function(){this.write(this.state.variables.builtin,n.Region.builtin)},t.prototype.saveSystemVariables=function(){this.write(this.state.variables.system,n.Region.system)},t.prototype.write=function(t,e){this.storage.write({region:g.StorageRegion.Values,regionKey:e,userId:this.player.id,gameId:n.gameId},{data:JSON.stringify(t)})},t}();e.Storage=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Label=i(41),e.FragmentDrawInfo=i(16),e.RubyParser=i(15),e.RubyAlign=e.RubyParser.RubyAlign;var n=i(17);e.defaultRubyParser=n.parse},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),r=i(15),o=i(16),a=i(17),s=function(t){function e(e){var i=this;if(!e.font&&!e.bitmapFont)throw g.ExceptionFactory.createAssertionError("Label#constructor: 'font' or 'bitmapFont' must be given to LabelParameterObject");return i=t.call(this,e)||this,i.text=e.text,i.bitmapFont=e.bitmapFont,i.font=e.font?e.font:e.bitmapFont,i.fontSize=e.fontSize,i._lineBreakWidth=e.width,i.lineBreak=!("lineBreak"in e)||e.lineBreak,i.lineGap=e.lineGap||0,i.textAlign="textAlign"in e?e.textAlign:g.TextAlign.Left,i.textColor=e.textColor,i.trimMarginTop="trimMarginTop"in e&&e.trimMarginTop,i.widthAutoAdjust="widthAutoAdjust"in e&&e.widthAutoAdjust,i.rubyEnabled=!("rubyEnabled"in e)||e.rubyEnabled,i.fixLineGap="fixLineGap"in e&&e.fixLineGap,i.rubyParser="rubyParser"in e?e.rubyParser:a.parse,e.rubyOptions||(e.rubyOptions={}),i.rubyOptions=e.rubyOptions,i.rubyOptions.rubyFontSize="rubyFontSize"in e.rubyOptions?e.rubyOptions.rubyFontSize:e.fontSize/2,i.rubyOptions.rubyBitmapFont="rubyBitmapFont"in e.rubyOptions?e.rubyOptions.rubyBitmapFont:i.bitmapFont,i.rubyOptions.rubyFont="rubyFont"in e.rubyOptions?e.rubyOptions.rubyFont:i.font,i.rubyOptions.rubyGap="rubyGap"in e.rubyOptions?e.rubyOptions.rubyGap:0,i.rubyOptions.rubyAlign="rubyAlign"in e.rubyOptions?e.rubyOptions.rubyAlign:r.RubyAlign.SpaceAround,i._lines=[],i._beforeText=void 0,i._beforeTextAlign=void 0,i._beforeFontSize=void 0,i._beforeLineBreak=void 0,i._beforeFont=void 0,i._beforeWidth=void 0,i._beforeRubyEnabled=void 0,i._beforeFixLineGap=void 0,i._beforeTrimMarginTop=void 0,i._beforeWidthAutoAdjust=void 0,i._beforeRubyOptions={},i._invalidateSelf(),i}return n(e,t),e.prototype.invalidate=function(){this._invalidateSelf(),t.prototype.invalidate.call(this)},e.prototype.renderCache=function(t){if(this.rubyEnabled||0!==this.fontSize){t.save();for(var e=0,i=0;i<this._lines.length;++i)this._lines[i].width>0&&this._lines[i].height>0&&t.drawImage(this._lines[i].surface,0,0,this._lines[i].width,this._lines[i].height,this._offsetX(this._lines[i].width),e),e+=this._lines[i].height+this.lineGap;this.textColor&&(t.setCompositeOperation(g.CompositeOperation.SourceAtop),t.fillRect(0,0,this._lineBreakWidth,this.height,this.textColor)),t.restore()}},e.prototype.destroy=function(){this._destroyLines(),t.prototype.destroy.call(this)},e.prototype._offsetX=function(t){switch(this.textAlign){case g.TextAlign.Left:return 0;case g.TextAlign.Right:return this._lineBreakWidth-t;case g.TextAlign.Center:return(this._lineBreakWidth-t)/2;default:return 0}},e.prototype._destroyLines=function(){for(var t=0;t<this._lines.length;t++)this._lines[t].surface&&!this._lines[t].surface.destroyed()&&this._lines[t].surface.destroy();this._lines=void 0},e.prototype._invalidateSelf=function(){if(this.fontSize<0)throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: fontSize must not be negative.");if(this.lineGap<-1*this.fontSize)throw g.ExceptionFactory.createAssertionError("Label#_invalidateSelf: lineGap must be greater than -1 * fontSize.");void 0!==this.bitmapFont&&(this.font=this.bitmapFont),void 0!==this.rubyOptions.rubyBitmapFont&&(this.rubyOptions.rubyFont=this.rubyOptions.rubyBitmapFont),this._beforeWidth!==this.width&&(this._lineBreakWidth=this.width),(this._beforeText!==this.text||this._beforeFontSize!==this.fontSize||this._beforeFont!==this.font||this._beforeLineBreak!==this.lineBreak||this._beforeWidth!==this.width&&!0===this._beforeLineBreak||this._beforeTextAlign!==this.textAlign||this._beforeRubyEnabled!==this.rubyEnabled||this._beforeFixLineGap!==this.fixLineGap||this._beforeTrimMarginTop!==this.trimMarginTop||this._beforeWidthAutoAdjust!==this.widthAutoAdjust||this._isDifferentRubyOptions(this._beforeRubyOptions,this.rubyOptions))&&this._updateLines(),this.widthAutoAdjust&&(this.width=Math.ceil(this._lines.reduce(function(t,e){return Math.max(t,e.width)},0)));for(var t=this.lineGap*(this._lines.length-1),e=0;e<this._lines.length;e++)t+=this._lines[e].height;this.height=t,this._beforeText=this.text,this._beforeTextAlign=this.textAlign,this._beforeFontSize=this.fontSize,this._beforeLineBreak=this.lineBreak,this._beforeFont=this.font,this._beforeWidth=this.width,this._beforeRubyEnabled=this.rubyEnabled,this._beforeFixLineGap=this.fixLineGap,this._beforeTrimMarginTop=this.trimMarginTop,this._beforeWidthAutoAdjust=this.widthAutoAdjust,this._beforeRubyOptions.rubyFontSize=this.rubyOptions.rubyFontSize,this._beforeRubyOptions.rubyFont=this.rubyOptions.rubyFont,this._beforeRubyOptions.rubyGap=this.rubyOptions.rubyGap,this._beforeRubyOptions.rubyAlign=this.rubyOptions.rubyAlign},e.prototype._updateLines=function(){for(var t=this.rubyEnabled?this.rubyParser(this.text):[this.text],e=this._divideToLines(t),i=[],n=this._beforeFontSize===this.fontSize&&this._beforeFont===this.font&&!this._isDifferentRubyOptions(this._beforeRubyOptions,this.rubyOptions),r=0;r<e.length;r++){var o=e[r],a=this._lines[r];n&&void 0!==a&&o.sourceText===a.sourceText&&o.width===a.width&&o.height===a.height?i.push(a):(a&&a.surface&&!a.surface.destroyed()&&a.surface.destroy(),this._drawLineInfoSurface(o),i.push(o))}for(r=i.length;r<this._lines.length;r++){(a=this._lines[r]).surface&&!a.surface.destroyed()&&a.surface.destroy()}this._lines=i},e.prototype._drawLineInfoSurface=function(t){var e=t.fragmentDrawInfoArray,i=this._calcRubyHeightInfo(e),n=this.scene.game.resourceFactory.createSurface(Math.ceil(t.width),Math.ceil(t.height)),r=n.renderer();r.begin(),r.save();for(var a=i.hasRubyFragmentDrawInfo||this.fixLineGap?this.rubyOptions.rubyGap+i.maxRubyGlyphHeightWithOffsetY:0,s=t.minMinusOffsetY,h=0;h<e.length;h++){var u=e[h];u instanceof o.RubyFragmentDrawInfo?this._drawRubyFragmentDrawInfo(r,u,a-s,-i.minRubyMinusOffsetY):u instanceof o.StringDrawInfo&&this._drawStringGlyphs(r,this.font,u.glyphs,this.fontSize,0,a-s,0),r.translate(u.width,0)}r.restore(),r.end(),t.surface=n},e.prototype._drawStringGlyphs=function(t,e,i,n,r,o,a){void 0===a&&(a=0),t.save(),t.translate(r,o);for(var s=0;s<i.length;s++){var h=i[s],u=n/e.size,c=h.advanceWidth*u;t.save(),t.transform([u,0,0,u,0,0]),h.width>0&&h.height>0&&t.drawImage(h.surface,h.x,h.y,h.width,h.height,h.offsetX,h.offsetY),t.restore(),t.translate(c+a,0)}t.restore()},e.prototype._drawRubyFragmentDrawInfo=function(t,e,i,n){var o,a,s,h,u=e.fragment,c="rubyFontSize"in u?u.rubyFontSize:this.rubyOptions.rubyFontSize,l="rubyAlign"in u?u.rubyAlign:this.rubyOptions.rubyAlign,d="rubyFont"in u?u.rubyFont:this.rubyOptions.rubyFont,p=e.rtWidth>e.rbWidth,f=e.width,y=e.rtWidth,_=e.rbWidth;switch(l){case r.RubyAlign.Center:s=0,h=0,o=p?0:(f-y)/2,a=p?(f-_)/2:0;break;case r.RubyAlign.SpaceAround:s=e.rubyGlyphs.length>0?(f-y)/e.rubyGlyphs.length:0,h=0,o=p?0:s/2,a=p?(f-_)/2:0;break;default:throw g.ExceptionFactory.createAssertionError("Label#_drawRubyFragmentDrawInfo: unknown rubyAlign.")}this._drawStringGlyphs(t,this.font,e.glyphs,this.fontSize,a,i,h),this._drawStringGlyphs(t,d,e.rubyGlyphs,c,o,n,s)},e.prototype._calcRubyHeightInfo=function(t){for(var e,i=this.rubyOptions.rubyFontSize,n=0,r=this.rubyOptions.rubyGap,a=!1,s=0,h=0;h<t.length;h++){var u=t[h];if(u instanceof o.RubyFragmentDrawInfo){var c=u.fragment;c.rubyFontSize>i&&(i=c.rubyFontSize),c.rubyGap>r&&(r=c.rubyGap);var l=(c.rubyFontSize?c.rubyFontSize:this.rubyOptions.rubyFontSize)/(c.rubyFont?c.rubyFont.size:this.rubyOptions.rubyFont.size),d=Math.max.apply(Math,u.rubyGlyphs.map(function(t){return t.offsetY>0?t.height+t.offsetY:t.height})),p=Math.min.apply(Math,u.rubyGlyphs.map(function(t){return t.offsetY>0?t.offsetY:0}));n<d*l&&(n=d*l);var f=c.rubyFont?c.rubyFont:this.rubyOptions.rubyFont,g=this._calcStandardOffsetY(f),y=(d-Math.min(p,g))*l;s<y&&(s=y,e=Math.min(p,g)*l),a=!0}}0===n&&(n=this.rubyOptions.rubyFontSize);return{maxRubyFontSize:i,maxRubyGlyphHeightWithOffsetY:n,minRubyMinusOffsetY:this.trimMarginTop?e:0,maxRubyGap:r,hasRubyFragmentDrawInfo:a}},e.prototype._divideToLines=function(t){for(var e={resultLines:[],currentStringDrawInfo:new o.StringDrawInfo("",0,[]),currentLineInfo:{sourceText:"",fragmentDrawInfoArray:[],width:0,height:0,minMinusOffsetY:0,surface:void 0}},i=0;i<t.length;i++){var n=t[i];if("string"==typeof n){for(var r=n.replace(/\r\n|\n/g,"\r"),a=0;a<r.length;a++)if("\r"===r[a])this._tryPushCurrentStringDrawInfo(e),this._feedLine(e);else{var s=this.font.glyphForCharacter(r[a].charCodeAt(0)),h=this.fontSize/this.font.size,u=s.advanceWidth*h;if(u<=0)continue;this._needLineBreak(e,u)&&(this._tryPushCurrentStringDrawInfo(e),this._feedLine(e)),this._addToCurrentStringDrawInfo(e,u,s,r[a])}this._tryPushCurrentStringDrawInfo(e)}else{var c=this._createRubyFragmentDrawInfo(n);if(c.width<=0)continue;this._needLineBreak(e,c.width)&&this._feedLine(e),e.currentLineInfo.fragmentDrawInfoArray.push(c),e.currentLineInfo.width+=c.width,e.currentLineInfo.sourceText+=n.text}}return this._feedLine(e),e.resultLines},e.prototype._createStringGlyph=function(t,e){return Array.prototype.map.call(t,function(t,i,n){return e.glyphForCharacter(n.charCodeAt(i))})},e.prototype._createRubyFragmentDrawInfo=function(t){var e=this._createStringGlyph(t.rb,this.font),i=this._createStringGlyph(t.rt,this.rubyOptions.rubyFont),n="rubyFont"in t?t.rubyFont:this.rubyOptions.rubyFont,r="rubyFontSize"in t?t.rubyFontSize:this.rubyOptions.rubyFontSize,a=this.fontSize/this.font.size,s=r/n.size,h=e.length>0?e.map(function(t){return t.advanceWidth}).reduce(function(t,e){return t+e})*a:0,u=i.length>0?i.map(function(t){return t.advanceWidth}).reduce(function(t,e){return t+e})*s:0,c=h>u?h:u;return new o.RubyFragmentDrawInfo(t,c,h,u,e,i)},e.prototype._tryPushCurrentStringDrawInfo=function(t){t.currentStringDrawInfo.width>0&&(t.currentLineInfo.fragmentDrawInfoArray.push(t.currentStringDrawInfo),t.currentLineInfo.width+=t.currentStringDrawInfo.width,t.currentLineInfo.sourceText+=t.currentStringDrawInfo.text),t.currentStringDrawInfo=new o.StringDrawInfo("",0,[])},e.prototype._feedLine=function(t){var e=this.fontSize/this.font.size,i=1/0,n=0,r=0;t.currentLineInfo.fragmentDrawInfoArray.forEach(function(t){t.glyphs.forEach(function(t){n>t.offsetY&&(n=t.offsetY),i>t.offsetY&&(i=t.offsetY);var e=t.offsetY>0?t.height+t.offsetY:t.height;r<e&&(r=e)})}),n*=e,r=t.currentLineInfo.fragmentDrawInfoArray.length>0?r*e-n:this.fontSize,r=Math.ceil(r);var o=this._calcRubyHeightInfo(t.currentLineInfo.fragmentDrawInfoArray);if(t.currentLineInfo.height=o.hasRubyFragmentDrawInfo||this.fixLineGap?r+o.maxRubyGlyphHeightWithOffsetY+o.maxRubyGap:r,t.currentLineInfo.minMinusOffsetY=n,this.trimMarginTop){var a=Math.min(i,this._calcStandardOffsetY(this.font))*e;t.currentLineInfo.height-=a,t.currentLineInfo.minMinusOffsetY+=a}t.resultLines.push(t.currentLineInfo),t.currentLineInfo={sourceText:"",fragmentDrawInfoArray:[],width:0,height:0,minMinusOffsetY:0,surface:void 0}},e.prototype._addToCurrentStringDrawInfo=function(t,e,i,n){t.currentStringDrawInfo.width+=e,t.currentStringDrawInfo.glyphs.push(i),t.currentStringDrawInfo.text+=n},e.prototype._needLineBreak=function(t,e){return this.lineBreak&&e>0&&t.currentLineInfo.width+t.currentStringDrawInfo.width+e>this._lineBreakWidth&&t.currentLineInfo.width+t.currentStringDrawInfo.width>0},e.prototype._isDifferentRubyOptions=function(t,e){return t.rubyFontSize!==e.rubyFontSize||t.rubyFont!==e.rubyFont||t.rubyGap!==e.rubyGap||t.rubyAlign!==e.rubyAlign},e.prototype._calcStandardOffsetY=function(t){return t.glyphForCharacter("M".charCodeAt(0)).offsetY},e}(g.CacheableE);t.exports=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=function(){function t(t){this.scene=t,this.root=new g.E({scene:t}),this.scene.append(this.root),this.group=new Map}return t.prototype.append=function(t,e){var i=this.group.get(e.name);i?i.append(t):((i=new g.E({scene:this.scene,width:this.scene.game.width,height:this.scene.game.height,x:0,y:0,opacity:e.opacity})).append(t),this.root.append(i),this.group.set(e.name,i))},t.prototype.remove=function(t){var e=this.group.get(t);e&&this.group.delete(t)&&e.destroy()},t.prototype.applyConfig=function(t){this.evaluate(t.name,function(e){void 0!==t.visible&&(t.visible?e.show():e.hide());var i=!1;void 0!==t.opacity&&(e.opacity=t.opacity,i=!0),void 0!==t.x&&(e.x=t.x,i=!0),void 0!==t.y&&(e.y=t.y,i=!0),i&&e.modified()})},t.prototype.top=function(t){var e=this;this.evaluate(t,function(t){return e.root.append(t)})},t.prototype.evaluate=function(t,e){var i=this.group.get(t);if(!i)throw new n.GameError("layer not found",{name:t});e(i)},t}();e.LayerGroup=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=function(){function t(t,e){this.game=t,this.group=new Map,this.config=e}return t.prototype.add=function(t,e){var i=this.config[t];i&&e.changeVolume(i);var n=this.group.get(t);n||(n=[],this.group.set(t,n)),n.push(e)},t.prototype.changeVolume=function(t,e){var i=this.group.get(t);if(i)for(var n=0,r=i;n<r.length;n++){r[n].changeVolume(e)}},t.prototype.remove=function(t){var e=this.group.get(t.group);if(e)if(t.assetId){var i=e.findIndex(function(e){return e.currentAudio.id===t.assetId});if(!(i>0))throw new n.GameError("audio not found",t);e[i].stop(),e.splice(i,1)}else{if(!this.group.delete(t.group))throw new n.GameError("audio group not found",t);for(var r=0,o=e;r<o.length;r++){o[r].stop()}}},t}();e.AudioGroup=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=function(){function t(t){this.scripts=t}return t.prototype.register=function(t,e){this.scripts.set(t,e)},t.prototype.call=function(t,e){var i=this.scripts.get(e.tag);if(i)try{i(t,e.data)}catch(e){this.call(t,{tag:n.Tag.exception,data:e})}else{var r=new n.GameError("script tag was not registered",e);this.call(t,{tag:n.Tag.exception,data:r})}},t}();e.ScriptManager=r},function(t,e,i){e.Timeline=i(46),e.Tween=i(25),e.Easing=i(26)},function(t,e,i){var n=i(25),r=function(){function t(t){this._scene=t,this._tweens=[],this._fps=this._scene.game.fps,this.paused=!1,t.update.handle(this,this._handler)}return t.prototype.create=function(t,e){var i=new n(t,e);return this._tweens.push(i),i},t.prototype.remove=function(t){var e=this._tweens.indexOf(t);e<0||this._tweens.splice(e,1)},t.prototype.clear=function(){this._tweens.length=0},t.prototype.destroy=function(){this._tweens.length=0,this._scene.destroyed()||this._scene.update.remove(this,this._handler),this._scene=void 0},t.prototype.destroyed=function(){return void 0===this._scene},t.prototype._handler=function(){if(0!==this._tweens.length&&!this.paused){for(var t=[],e=0;e<this._tweens.length;++e){var i=this._tweens[e];i.destroyed()||(i._fire(1e3/this._fps),t.push(i))}this._tweens=t}},t}();t.exports=r},function(t,e){var i;!function(t){t[t.Wait=0]="Wait",t[t.Call=1]="Call",t[t.TweenTo=2]="TweenTo",t[t.TweenBy=3]="TweenBy",t[t.TweenByMult=4]="TweenByMult",t[t.Cue=5]="Cue",t[t.Every=6]="Every"}(i||(i={})),t.exports=i},function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=i(31),o=i(30),a=i(29),s=i(28),h=function(){function t(t){this._buf=new Array(t),this._i=0,this._disposed=null}return t.prototype.addDelta=function(t){this._buf[this._i]=t,this._i=(this._i+1)%this._buf.length,this._i===this._disposed&&(this._disposed=null)},t.prototype.average=function(){for(var t=0,e=0,i=0,n=null!=this._disposed?this._disposed:(this._i+1)%this._buf.length;n!==this._i;n=(n+1)%this._buf.length)t+=this._buf[n].x,e+=this._buf[n].y,++i;return i>0?{x:t/i,y:e/i}:{x:0,y:0}},t.prototype.reset=function(){this._disposed=this._i},t}(),u=function(t){function e(e){var i=t.call(this,e)||this;return i.onModified=new g.Trigger,i}return n(e,t),e.prototype.destroy=function(){this.onModified.destroy(),this.onModified=null,t.prototype.destroy.call(this)},e.prototype.modified=function(e){return this.onModified&&this.onModified.fire(),t.prototype.modified.call(this,e)},e}(g.E);e.ScrolledContent=u;var c=function(t){function e(e){var i=t.call(this,e)||this;return i.onContentModified=new g.Trigger,i._offsetContainer=new g.E({scene:e.scene,parent:i}),i._content=new u({scene:e.scene,parent:i._offsetContainer}),i._content.onModified.add(i.onContentModified.fire,i.onContentModified),i}return n(e,t),e.prototype.destroy=function(){this.onContentModified.destroy(),this.onContentModified=null,t.prototype.destroy.call(this)},e.prototype.offsetContainer=function(){return this._offsetContainer},e.prototype.content=function(){return this._content},e}(g.E);e.ScrolledContentContainer=c;var l;!function(t){t.Linear=function(t){return t},t.EaseInQuad=function(t){return t*t},t.EaseOutQuad=function(t){return-t*(t-2)},t.EaseInOutQuad=function(t){return t<.5?t*t*2:-((2*t-1)*(2*t-3)-1)/2},t.EaseInQubic=function(t){return t*t*t},t.EaseOutQubic=function(t){return(t-1)*(t-1)*(t-1)+1},t.EaseInOutQubic=function(t){return t<.5?t*t*t*4:((2*t-2)*(2*t-2)*(2*t-2)+2)/2},t.EaseInSine=function(t){return 1-Math.cos(t*(Math.PI/2))},t.EaseOutSine=function(t){return Math.sin(t*(Math.PI/2))},t.EaseInOutSine=function(t){return-(Math.cos(Math.PI*t)-1)/2}}(l=e.EasingFunction||(e.EasingFunction={}));var d=function(t){function e(e){var i=t.call(this,e)||this;return i._bgImage=null,i._barImage=null,i._isVertical=!!e.vertical,i._isHorizontal=!!e.horizontal,i._touchScroll=!!e.touchScroll,i._momentumScroll=null==e.momentumScroll||e.momentumScroll,i._insetBars=!!e.insetBars,i._extraDrawSize=100,i._extraDrawOffsetX=i._extraDrawSize,i._extraDrawOffsetY=i._extraDrawSize,i._contentContainer=new c({scene:e.scene,parent:i}),i._horizontalBar=new o.NullScrollbar({scene:e.scene,parent:i}),i._verticalBar=null,!0!==e.vertical&&!0!==e.horizontal||(i._bgImage=r.createDefaultScrollbarImage(e.scene.game,7,"rgba(255, 255, 255, 0.2)",4,"rgba(218, 218, 218, 0.5)"),i._barImage=r.createDefaultScrollbarImage(e.scene.game,7,"rgba(255, 255, 255, 0.5)",4,"rgba(164, 164, 164, 0.7)")),i._verticalBar=!0===e.vertical?new a.NinePatchVerticalScrollbar({scene:e.scene,bgImage:i._bgImage,image:i._barImage}):e.vertical?e.vertical:new o.NullScrollbar({scene:e.scene}),i._verticalBar.x=i._insetBars?i.width-i._verticalBar.width:i.width,i.append(i._verticalBar),i._verticalBar.onChangeBarPositionRate.add(i._handleOnChangeVerticalPositionRate,i),i._horizontalBar=!0===e.horizontal?new s.NinePatchHorizontalScrollbar({scene:e.scene,bgImage:i._bgImage,image:i._barImage}):e.horizontal?e.horizontal:new o.NullScrollbar({scene:e.scene}),i._horizontalBar.y=i._insetBars?i.height-i._horizontalBar.height:i.height,i.append(i._horizontalBar),i._horizontalBar.onChangeBarPositionRate.add(i._handleOnChangeHorizontalPositionRate,i),i._surface=null,i._renderer=null,i._isCached=!1,i._renderedCamera=null,i._renderOffsetX=0,i._renderOffsetY=0,i._contentBoundingWidth=0,i._contentBoundingHeight=0,i._isUpdateBoundingRectRequested=!1,i._isUpdateContentScrollRequested=!1,i._isUpdateScrollbarRequested=!1,i._isFlushRequested=!1,i._lastNotifiedVerticalRate=null,i._lastNotifiedHorizontalRate=null,i._deltaX=0,i._deltaY=0,i._apiRequestedOffsetX=null,i._apiRequestedOffsetY=null,i._beforeWidth=e.width,i._beforeHeight=e.height,i._frameTasks=[],i._momentumBuffer=new h(3),i._contentContainer.onContentModified.add(i._handleContentModified,i),i._touchScroll&&(i.touchable=!0,i.pointDown.add(i._handlePointDown,i),i.pointMove.add(i._handlePointMove,i),i.pointUp.add(i._handlePointUp,i)),i._requestUpdateBoundingRect(),i._requestUpdateScrollbar(),i}return n(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this._contentContainer.content()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalBar",{get:function(){return this._horizontalBar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalBar",{get:function(){return this._verticalBar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollOffsetX",{get:function(){return-this._contentContainer.offsetContainer().x},set:function(t){this._apiRequestedOffsetX=-t,this._requestUpdateContentScroll(),this._requestUpdateScrollbar()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollOffsetY",{get:function(){return-this._contentContainer.offsetContainer().y},set:function(t){this._apiRequestedOffsetY=-t,this._requestUpdateContentScroll(),this._requestUpdateScrollbar()},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._contentContainer=null,this._horizontalBar=null,this._verticalBar=null,this._surface&&(this._surface.destroy(),this._surface=null),this._renderer=null,this._isCached=!1,this._renderedCamera=null,this._renderOffsetX=0,this._renderOffsetY=0,this._bgImage&&(this._bgImage.destroy(),this._bgImage=null),this._barImage&&(this._barImage.destroy(),this._barImage=null),t.prototype.destroy.call(this)},e.prototype.getScrollOffsetPercentX=function(){this._flushModification();var t=this._contentBoundingWidth-this.width;return t>0?100*this.scrollOffsetX/t:0},e.prototype.setScrollOffsetPercentX=function(t){this._flushModification();var e=Math.max(this._contentBoundingWidth-this.width,0);this.scrollOffsetX=Math.floor(t*e/100)},e.prototype.getScrollOffsetPercentY=function(){this._flushModification();var t=this._contentBoundingHeight-this.height;return t>0?100*this.scrollOffsetY/t:0},e.prototype.setScrollOffsetPercentY=function(t){this._flushModification();var e=Math.max(this._contentBoundingHeight-this.height,0);this.scrollOffsetY=Math.floor(t*e/100)},e.prototype.scrollToX=function(t,e,i){this._addFrameTask({type:"scroll",origX:-this._contentContainer.offsetContainer().x,x:t,duration:e,easing:i,count:0})},e.prototype.scrollToY=function(t,e,i){this._addFrameTask({type:"scroll",origY:-this._contentContainer.offsetContainer().y,y:t,duration:e,easing:i,count:0})},e.prototype.scrollToPercentX=function(t,e,i){this._addFrameTask({type:"scroll",origX:-this._contentContainer.offsetContainer().x,perX:t,duration:e,easing:i,count:0})},e.prototype.scrollToPercentY=function(t,e,i){this._addFrameTask({type:"scroll",origY:-this._contentContainer.offsetContainer().y,perY:t,duration:e,easing:i,count:0})},e.prototype.renderSelf=function(t,e){if(this._renderedCamera!==e&&(this._isCached=!1,this._renderedCamera=e),this._isCached||this._renderCache(e),this.children)for(var i=this.children,n=0;n<i.length;++n)if(i[n]===this._contentContainer){if(this._surface&&this.width>0&&this.height>0){var r=this._extraDrawOffsetX-this._renderOffsetX,o=this._extraDrawOffsetY-this._renderOffsetY;t.drawImage(this._surface,r,o,this.width,this.height,0,0)}}else i[n].render(t,e);return!1},e.prototype.modified=function(e){e&&(this._isCached=!1);var i=!1;this.width!==this._beforeWidth&&(i=!0,this._beforeWidth=this.width,this._verticalBar&&(this._verticalBar.x=this._insetBars?this.width-this._verticalBar.width:this.width,this._verticalBar.modified())),this.height!==this._beforeHeight&&(i=!0,this._beforeHeight=this.height,this._horizontalBar&&(this._horizontalBar.y=this._insetBars?this.height-this._horizontalBar.height:this.height,this._horizontalBar.modified())),i&&(this._requestUpdateContentScroll(),this._requestUpdateScrollbar()),t.prototype.modified.call(this,e)},e.prototype.shouldFindChildrenByPoint=function(t){var e=this.width+(this._insetBars?0:this._verticalBar.width),i=this.height+(this._insetBars?0:this._horizontalBar.height);return 0<=t.x&&t.x<e&&0<=t.y&&t.y<i},e.prototype._addFrameTask=function(t){this._frameTasks.push(t),1===this._frameTasks.length&&this._contentContainer.update.add(this._onUpdate,this)},e.prototype._cancelFrameTask=function(t){for(var e=0;e<this._frameTasks.length;++e){var i=this._frameTasks[e];i.type===t&&(i.done=!0)}},e.prototype._onUpdate=function(){for(var t=0;t<this._frameTasks.length;++t){var e=this._frameTasks[t];switch(e.done&&this._frameTasks.splice(t,1),++e.count,e.type){case"momentum":var i=Math.pow(.9,e.count),n={x:e.x*i,y:e.y*i};e.done=(!this._isHorizontal||Math.abs(n.x)<.1)&&(!this._isVertical||Math.abs(n.y)<.1),this._addScrollDelta(n);break;case"scroll":this._flushModification();var r=Math.min(1e3*e.count/(e.duration*this.scene.game.fps),1),o=e.easing?e.easing(r):r;if(null!=e.x||null!=e.perX){var a=null!=e.x?e.x:e.perX*Math.max(this._contentBoundingWidth-this.width,0)/100,s=e.origX+o*(a-e.origX);this.scrollOffsetX=s}if(null!=e.y||null!=e.perY){var h=null!=e.y?e.y:e.perY*Math.max(this._contentBoundingHeight-this.height,0)/100,u=e.origY+o*(h-e.origY);this.scrollOffsetY=u}e.done=1===r;break;default:throw new Error("Scrollable#_onUpdate: never reach")}}0===this._frameTasks.length&&this._contentContainer.update.remove(this._onUpdate,this)},e.prototype._handleContentModified=function(){this._requestUpdateBoundingRect()},e.prototype._handleOnChangeVerticalPositionRate=function(t){this._lastNotifiedVerticalRate=t,this._requestUpdateContentScroll()},e.prototype._handleOnChangeHorizontalPositionRate=function(t){this._lastNotifiedHorizontalRate=t,this._requestUpdateContentScroll()},e.prototype._handlePointDown=function(t){this._cancelFrameTask("momentum"),this._momentumBuffer.reset()},e.prototype._handlePointMove=function(t){this._addScrollDelta(t.prevDelta),this._momentumBuffer.addDelta(t.prevDelta)},e.prototype._handlePointUp=function(t){if(this._momentumScroll){var e=this._momentumBuffer.average();(this._isHorizontal&&Math.abs(e.x)>2||this._isVertical&&Math.abs(e.y)>2)&&this._addFrameTask({type:"momentum",x:e.x,y:e.y,count:0})}},e.prototype._addScrollDelta=function(t){this._deltaX+=t.x,this._deltaY+=t.y,this._requestUpdateScrollbar(),this._requestUpdateContentScroll(),this.modified()},e.prototype._requestUpdateBoundingRect=function(){this._isUpdateBoundingRectRequested||(this._isUpdateBoundingRectRequested=!0,this._requestFlushModification())},e.prototype._requestUpdateScrollbar=function(){this._isUpdateScrollbarRequested||(this._isUpdateScrollbarRequested=!0,this._requestFlushModification())},e.prototype._requestUpdateContentScroll=function(){this._isUpdateContentScrollRequested||(this._isUpdateContentScrollRequested=!0,this._requestFlushModification())},e.prototype._requestFlushModification=function(){var t=this;this._isFlushRequested||(this._isFlushRequested=!0,this.scene.game._callSceneAssetHolderHandler({callHandler:function(){t.destroyed()||t._flushModification()}}))},e.prototype._flushModification=function(){if(this._isFlushRequested){this._isFlushRequested=!1;var t=!1;this._isUpdateBoundingRectRequested&&(this._isUpdateBoundingRectRequested=!1,t=this._updateBoundingRect()),(t||this._isUpdateContentScrollRequested)&&(this._isUpdateContentScrollRequested=!1,this._updateContentScroll()),(t||this._isUpdateScrollbarRequested)&&(this._isUpdateScrollbarRequested=!1,this._updateScrollBar())}},e.prototype._updateBoundingRect=function(){var t=this._calculateBoundingRectSize(),e=!1;return this._contentBoundingWidth!==t.width&&(this._contentBoundingWidth=t.width,e=!0),this._contentBoundingHeight!==t.height&&(this._contentBoundingHeight=t.height,e=!0),e},e.prototype._calculateBoundingRectSize=function(){var t=this._contentContainer.content().calculateBoundingRect();return{width:t.right-t.left,height:t.bottom-t.top}},e.prototype._updateContentScroll=function(){var t=this._contentContainer.offsetContainer(),e=this._lastNotifiedVerticalRate,i=this._lastNotifiedHorizontalRate,n=this._deltaX,r=this._deltaY,o=this._apiRequestedOffsetX,a=this._apiRequestedOffsetY;if(this._lastNotifiedVerticalRate=null,this._lastNotifiedHorizontalRate=null,this._deltaX=0,this._deltaY=0,this._apiRequestedOffsetX=null,this._apiRequestedOffsetY=null,this._isHorizontal){var s=t.x,h=null!=o?o:s,u=0!==n?h+n:null!=i?-i*this._contentBoundingWidth:h,c=Math.max(Math.min(u,0),Math.min(this.width-this._contentBoundingWidth,0));t.x=c,this._renderOffsetX+=t.x-s}if(this._isVertical){var l=t.y,d=null!=a?a:l,p=0!==r?d+r:null!=e?-e*this._contentBoundingHeight:d,f=Math.max(Math.min(p,0),Math.min(this.height-this._contentBoundingHeight,0));t.y=f,this._renderOffsetY+=f-l}(Math.abs(this._renderOffsetX)>this._extraDrawSize||Math.abs(this._renderOffsetY)>this._extraDrawSize)&&(this._isCached=!1)},e.prototype._updateScrollBar=function(){var t=this._contentContainer.offsetContainer();this._horizontalBar.setBarProperties(-t.x/this._contentBoundingWidth,this._contentBoundingWidth,this.width),this._verticalBar.setBarProperties(-t.y/this._contentBoundingHeight,this._contentBoundingHeight,this.height)},e.prototype._renderCache=function(t){var e=Math.ceil(this.width+2*this._extraDrawSize),i=Math.ceil(this.height+2*this._extraDrawSize),n=!this._surface||this._surface.width<e||this._surface.height<i;n&&(this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this._surface=this.scene.game.resourceFactory.createSurface(e,i),this._renderer=this._surface.renderer()),this._renderer.begin(),n||this._renderer.clear(),this._renderer.save(),this._renderer.translate(this._extraDrawOffsetX,this._extraDrawOffsetY),this._contentContainer.render(this._renderer,t),this._renderer.restore(),this._renderOffsetX=0,this._renderOffsetY=0,this._renderer.end(),this._isCached=!0},e}(g.E);d.Easing=l,e.Scrollable=d},function(t,e,i){"use strict";function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),n(i(32)),n(i(50))},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r,o=i(32),a=i(51);!function(t){t[t.Top=0]="Top",t[t.Bottom=1]="Bottom"}(r=e.Position||(e.Position={}));var s=function(t){function e(e){var i=t.call(this,e)||this;return i._limit=e.limit,i.offset=0,i._width=i.width,i.padding=e.padding,i.lastOffset=0,i.touchable=!0,i}return n(e,t),e.prototype.append=function(e){if(this.children){var i=this.children[this.children.length-1];this.children.length%this.limit==0?e.x=i.x+i.width+this.padding+e.x:this.children.length%this._limit.horizontal==0?(e.x=this.children[this.children.length-this._limit.horizontal].x,e.y=i.y+i.height+e.y):(e.x=i.x+i.width+this.padding+e.x,e.y=i.y)}t.prototype.append.call(this,e);var n=Math.floor(this.children.length/this.limit);this.lastOffset=this.children.length%this.limit==0?n-1:n},e.prototype.previous=function(){this.offset>0&&this.move(this.offset-1)},e.prototype.next=function(){this.offset<this.lastOffset&&this.move(this.offset+1)},e.prototype.first=function(){this.offset>0&&this.move(0)},e.prototype.last=function(){this.offset<this.lastOffset&&this.move(this.lastOffset)},e.prototype.move=function(t){if(this.offset!==t&&t>=0&&t<=this.lastOffset){var e=this.offset;this.x=this.x+this._width*(e-t),this.offset=t,this.modified()}},e.prototype.modified=function(e){this.destroyed||this.resize(),t.prototype.modified.call(this,e)},Object.defineProperty(e.prototype,"limit",{get:function(){return this._limit.vertical*this._limit.horizontal},enumerable:!0,configurable:!0}),e.prototype.resize=function(){var t=this.children[this.children.length-1];this.width=Math.max(this.width,t.x+t.width)},e}(g.E);e.PaginationContent=s;var h=function(t){function e(e){var i=t.call(this,e)||this;void 0!==e.previous&&void 0!==e.next&&!0!==e.first&&!0!==e.last||(i._image=a.createDefaultButtonImage(e.scene.game,i.width/4,24,"rgba(164, 164, 164, 0.7)"));var n;switch(e.position){case r.Top:n=e.previous?e.previous.height:i._image.height;break;default:n=0}i._content=new s({scene:e.scene,width:e.width,height:e.height,y:n,limit:e.limit,padding:e.paddingRight}),i.append(i._content),i.touchable=!0;var h=Math.round(e.width/4);i.previous=e.previous?e.previous:new o.LabelButton({scene:e.scene,width:h,text:"<",image:i._image}),i.previous.onClick.add(function(){return i._content.previous()},i),i.previous.x=e.width/4;var u;switch(e.position){case r.Top:u=0;break;case r.Bottom:u=e.height-i.previous.height}return i.previous.y=u,i.append(i.previous),i.next=e.next?e.next:new o.LabelButton({scene:e.scene,width:h,text:">",image:i._image}),i.next.onClick.add(function(){return i._content.next()},i),i.next.x=e.width/2,i.next.y=u,i.append(i.next),e.first&&(i.first=!0===e.first?new o.LabelButton({scene:e.scene,width:h,text:"|<",image:i._image}):e.first,i.first.onClick.add(function(){return i._content.first()},i),i.first.x=0,i.first.y=u,i.append(i.first)),e.last&&(i.last=!0===e.last?new o.LabelButton({scene:e.scene,width:h,text:">|",image:i._image}):e.last,i.last.onClick.add(function(){return i._content.last()},i),i.last.x=e.width/4*3,i.last.y=u,i.append(i.last)),i}return n(e,t),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),e.prototype.moveOffset=function(t){this._content.move(t)},e.prototype.destroy=function(){this.previous=null,this.next=null,this.first=null,this.last=null,this._content=null,this._image&&(this._image.destroy(),this._image=null),t.prototype.destroy.call(this)},e}(g.Pane);e.Pagination=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createDefaultButtonImage=function(t,e,i,n){var r=Math.round(e),o=Math.round(i),a=t.resourceFactory.createSurface(r,o),s=a.renderer();return s.begin(),s.fillRect(0,0,r,o,n),s.end(),a}},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i(23),o=i(33),a=function(t){function e(e,i){var n=t.call(this,{scene:e,width:i.width,height:i.height})||this;return n.image=i,n.append(i),n}return n(e,t),e.prototype.push=function(){this.image.frameNumber=1,t.prototype.push.call(this)},e.prototype.unpush=function(){this.image.frameNumber=0,t.prototype.unpush.call(this)},e.create=function(t,i){var n=t.assets[i.assetId];return i.frame&&(void 0===i.frame.width&&(i.frame.width=n.width/3),void 0===i.frame.height&&(i.frame.height=n.height)),new e(t,o.createFrameSprite(t,n,i))},e}(r.Button);e.ImageButton=a},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=i(27),o=i(0),a=function(t){function e(e){var i=t.call(this,e)||this;i.touchable=!0,i.length=e.data.length,i.target=e.data.target,i.gameState=e.state,i.maxValue=e.data.max,i.defaultValue=e.data.default;var n=r.createDefaultScrollbarImage(e.scene.game,7,"rgba(255, 255, 255, 0.2)",4,"rgba(218, 218, 218, 0.5)"),a=r.createDefaultScrollbarImage(e.scene.game,7,"rgba(255, 255, 255, 0.5)",4,"rgba(164, 164, 164, 0.7)");switch(e.data.direction){case 0:i.bar=new r.NinePatchVerticalScrollbar({scene:e.scene,bgImage:n,image:a});break;case 1:i.bar=new r.NinePatchHorizontalScrollbar({scene:e.scene,bgImage:n,image:a})}i.width=i.bar.width,i.height=i.bar.height;var s=i.gameState.getValue(i.target);if("number"==typeof s)i.setPosRate(s/i.maxValue);else{if(void 0!==s)throw new o.GameError("target variable is not number type",e.data);i.setPosRate(i.defaultValue/i.maxValue)}return i.bar.onChangeBarPositionRate.add(function(t){i.gameState.setValue(i.target,i.maxValue*t)},i),i.append(i.bar),i}return n(e,t),e.prototype.reset=function(){this.setPosRate(this.defaultValue/this.maxValue)},e.prototype.setPosRate=function(t){this.bar.setBarProperties(t,this.length*this.length,this.length)},e}(g.Pane);e.Slider=a}]);
})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);
}