window.gLocalAssetContainer["node_modules/cowlick-engine/lib/components/Message.js"] = function(g) { !function(t,e,i,n,r){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=e("@akashic-extension/akashic-label"),o=e("cowlick-core"),l=function(t){function e(i){var n=t.call(this,e.toLabelParameters(i))||this;return n.index=0,n.counter=0,n.original={values:[]},n.current=[],n.gameState=i.gameState,n.textAlign=g.TextAlign.Left,n.config=i.config,n.onFinished=new g.Trigger,n.applySpeed(),n}return s(e,t),Object.defineProperty(e.prototype,"finished",{get:function(){return this.index>=this.original.values.length},enumerable:!0,configurable:!0}),e.prototype.updateText=function(t,e){this.config.system.alreadyRead&&e?this.textColor=this.config.font.alreadyReadColor:this.textColor=this.config.font.color,t.clear?(this.text="",this.original=t,this.index=0,this.counter=0):this.original={values:this.original.values.concat(t.values)},this.setCurrent(),this.gameState.variables.builtin[o.BuiltinVariable.realTimeDisplay]?this.showAll():this.applySpeed()},e.prototype.applySpeed=function(){this.identifier&&this.removeTimer(),this.identifier=this.scene.setInterval(this.next,this.gameState.variables.builtin[o.BuiltinVariable.messageSpeed],this)},e.prototype.applyFontSetting=function(){this.fontSize=this.gameState.variables.builtin[o.BuiltinVariable.fontSize],this.textColor=this.gameState.variables.builtin[o.BuiltinVariable.fontColor],this.invalidate()},e.prototype.showAll=function(){if(!this.finished){this.removeTimer(),this.text="";for(var t=0,e=this.original.values;t<e.length;t++){var i=e[t];if("string"==typeof i)this.text+=i;else if(Array.isArray(i))this.text+=i[i.length-1].value;else{var n=this.gameState.getStringValue(i);if(!n)throw new o.GameError("変数の取得に失敗しました",i);this.text+=n}}this.index=this.original.values.length,this.onFinished.fire(this.text),this.invalidate()}},e.prototype.next=function(){if(!this.finished&&this.counter>=this.current.length&&(this.counter=0,this.index++,this.finished||this.setCurrent()),!this.finished){var t=this.current[this.counter];"string"==typeof t?this.text+=t:(0!==this.counter&&(this.text=this.text.substring(0,this.text.length-t.value.length)),this.text+=t.value),this.invalidate(),this.counter++}this.finished&&(this.removeTimer(),this.onFinished.fire(this.text))},e.prototype.removeTimer=function(){this.identifier&&(this.scene.clearInterval(this.identifier),this.identifier=null)},e.prototype.setCurrent=function(){var t=this.original.values[this.index];if("string"==typeof t)this.current=t.split(/.*?/);else if(Array.isArray(t))this.current=t;else{var e=this.gameState.getStringValue(t);if(!e)throw new o.GameError("変数の取得に失敗しました",t);this.current=e.split(/.*?/)}},e.toLabelParameters=function(t){var e=t.gameState.getValue({type:o.VariableType.builtin,name:o.BuiltinVariable.selectedFont}),i=t.config.font.list[e],n=t.gameState.getValue({type:o.VariableType.builtin,name:o.BuiltinVariable.fontSize}),r=t.gameState.getValue({type:o.VariableType.builtin,name:o.BuiltinVariable.fontColor});return{scene:t.scene,font:i,text:"",fontSize:n,textColor:r,width:t.width,x:t.x,y:t.y,fixLineGap:!0}},e}(a.Label);t.Message=l}(g.module.exports,g.module.require,g.module,g.filename,g.dirname);}